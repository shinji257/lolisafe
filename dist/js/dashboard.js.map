{"version":3,"sources":["dashboard.js"],"names":["const","lsKeys","token","viewType","uploads","uploadsAll","selected","albums","albumsAll","users","originalNames","page","section","dom","localStorage","username","permissions","menusContainer","menus","currentView","views","type","album","pageNum","filters","all","prevPageNums","checkboxes","lastSelected","selectAlbumContainer","cache","clipboardJS","lazyLoad","albumsSidebarCollapse","albumsSidebarCollapsible","imageExts","videoExts","audioExts","isSomethingLoading","fadingIn","albumTitleMaxLength","albumDescMaxLength","unhide","document","querySelector","classList","add","remove","onError","error","console","content","createElement","innerHTML","toString","swal","title","icon","onAxiosError","statusText","520","521","522","523","524","525","526","527","530","response","status","description","data","preparePage","verifyToken","window","location","checkClientVersion","apiVersion","match","src","text","buttons","confirm","closeModal","then","reload","reloadOnError","axios","post","success","removeItem","defaults","headers","common","version","prepareDashboard","catch","addEventListener","domClick","event","target","contains","preventDefault","itemMenus","selector","onclick","getUploads","deleteUploadsByNames","getAlbums","changeToken","changePassword","logout","params","group","getStatistics","getUsers","loop","i","item","warnSomethingLoading","call","Object","assign","trigger","currentTarget","forceScroll","push","length","moderator","getAlbumsSidebar","prepareShareX","updateTrigger","timer","newState","parentNode","tagName","className","includes","let","getItemID","element","parent","parseInt","dataset","id","action","hasAttribute","stopPropagation","setUploadsView","toggleOriginalNames","addToAlbum","deleteUpload","addSelectedUploadsToAlbum","bulkDeleteUploads","displayPreview","uploadFiltersHelp","filterUploads","submitAlbum","editAlbum","disableAlbum","viewAlbumUploads","createUser","editUser","disableUser","deleteUser","viewUserUploads","getNewToken","clearSelection","select","selectAll","focusJumpToPage","switchPage","fadeInDom","disableFading","clearTimeout","setTimeout","scrollToDom","disableSmooth","scrollIntoView","behavior","block","inline","getByView","view","get","func","goto","jumpToPage","jumpid","checkValidity","parsed","value","isNaN","focus","url","test","minoffset","Date","getTimezoneOffset","pages","Math","ceil","count","files","autoPage","basedomain","max","pagination","paginate","extraControls","escape","controls","bottomExtraControls","replace","bottomPagination","unselected","showOriginalNames","hasExpiryDateColumn","some","file","expirydate","thumb","exec","extname","toLowerCase","previewable","name","original","prettyBytes","getPrettyBytes","size","prettyDate","getPrettyDate","timestamp","prettyExpiryDate","appendix","userid","albumid","table","upload","div","appendChild","querySelectorAll","allAlbums","tr","ip","checked","update","undefined","isimage","isvideo","isaudio","onload","body","onerror","log","setAttribute","splice","indexOf","JSON","stringify","selectInBetween","lastElement","thisIndex","index","lastIndex","abs","shiftKey","suffix","substring","proceed","Boolean","style","trim","filtersid","user","postBulkDeleteUploads","field","values","cb","failed","filter","textArea","seen","names","split","map","trimmed","prototype","hasOwnProperty","join","objective","dangerMode","cancel","Array","isArray","addUploadsToAlbum","ids","callback","choose","added","simple","list","getElementsByTagName","removeAttribute","homeDomain","createNewAlbum","albumUrl","enabled","download","public","requestLink","identifier","purge","albumsSidebar","oldAlbums","diffCount","innerText","collapsed","textExpand","textCollapse","collapse","li","a","sendNewPassword","pass","password","admin","displayGroup","groups","keys","registration","prettyTokenUpdate","usage","groupOptions","g","isHigher","isDisabledHelper","resetPassword","autoClose","displayName","totalItems","itemsPerPage","currentPage","numPages","template","start","end","elementsToShow","step","stats","rows","valKeys","j","totalForPercentage","available","used","total","toFixed","getPrettyUptime","toLocaleString","hrtime","defineProperty","varArgs","arguments$1","arguments","TypeError","to","nextSource","nextKey","writable","configurable","documentElement","selectedKeys","ls","parse","ClipboardJS","on","LazyLoad","bulmaCollapsible"],"mappings":"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","file":"dashboard.js","sourcesContent":["/* global swal, axios, ClipboardJS, LazyLoad, bulmaCollapsible */\n\nconst lsKeys = {\n  token: 'token',\n  viewType: {\n    uploads: 'viewTypeUploads',\n    uploadsAll: 'viewTypeUploadsAll'\n  },\n  selected: {\n    uploads: 'selectedUploads',\n    uploadsAll: 'selectedUploadsAll',\n    albums: 'selectedAlbums',\n    albumsAll: 'selectedAlbumsAll',\n    users: 'selectedUsers'\n  },\n  originalNames: {\n    uploads: 'originalNames',\n    uploadsAll: 'originalNamesAll'\n  }\n}\n\nconst page = {\n  // #dashboard\n  section: null,\n  // #page\n  dom: null,\n\n  // user token\n  token: localStorage[lsKeys.token],\n\n  // from api/tokens/verify\n  username: null,\n  permissions: null,\n\n  // sidebar menus\n  menusContainer: null,\n  menus: [],\n\n  currentView: null,\n  views: {\n    // params of uploads view\n    uploads: {\n      type: localStorage[lsKeys.viewType.uploads],\n      originalNames: localStorage[lsKeys.originalNames.uploads] === '1',\n      album: null, // album's id\n      pageNum: null\n    },\n    // params of uploads view (all)\n    uploadsAll: {\n      type: localStorage[lsKeys.viewType.uploadsAll],\n      originalNames: localStorage[lsKeys.originalNames.uploadsAll] === '1',\n      filters: null,\n      pageNum: null,\n      all: true\n    },\n    // params of albums view\n    albums: {\n      filters: null,\n      pageNum: null\n    },\n    // params of albums view (all)\n    albumsAll: {\n      filters: null,\n      pageNum: null,\n      all: true\n    },\n    // params of users view\n    users: {\n      filters: null,\n      pageNum: null\n    }\n  },\n  prevPageNums: {\n    uploads: null,\n    uploadsAll: null,\n    albums: null,\n    albumsAll: null,\n    users: null\n  },\n\n  // ids of selected items (shared across pages and will be synced with localStorage)\n  selected: {\n    uploads: [],\n    uploadsAll: [],\n    albums: [],\n    albumsAll: [],\n    users: []\n  },\n  checkboxes: [],\n  lastSelected: [],\n\n  // select album dom for dialogs/modals\n  selectAlbumContainer: null,\n\n  // cache for dialogs/modals\n  cache: {},\n\n  clipboardJS: null,\n  lazyLoad: null,\n  albumsSidebarCollapse: null,\n  albumsSidebarCollapsible: null,\n\n  imageExts: ['.gif', '.jpeg', '.jpg', '.png', '.svg', '.tif', '.tiff', '.webp'],\n  videoExts: ['.3g2', '.3gp', '.asf', '.avchd', '.avi', '.divx', '.evo', '.flv', '.h264', '.h265', '.hevc', '.m2p', '.m2ts', '.m4v', '.mk3d', '.mkv', '.mov', '.mp4', '.mpeg', '.mpg', '.mxf', '.ogg', '.ogv', '.ps', '.qt', '.rmvb', '.ts', '.vob', '.webm', '.wmv'],\n  audioExts: ['.flac', '.mp3', '.wav', '.wma'],\n\n  isSomethingLoading: false,\n  fadingIn: null,\n\n  albumTitleMaxLength: 70,\n  albumDescMaxLength: 4000\n}\n\npage.unhide = () => {\n  document.querySelector('#loader').classList.add('is-hidden')\n  page.section.classList.remove('is-hidden')\n}\n\n// Handler for regular JS errors\npage.onError = error => {\n  console.error(error)\n\n  const content = document.createElement('div')\n  content.innerHTML = `\n    <p><code>${error.toString()}</code></p>\n    <p>Please check your console for more information.</p>\n  `\n  return swal({\n    title: 'An error occurred!',\n    icon: 'error',\n    content\n  })\n}\n\n// Handler for Axios errors\npage.onAxiosError = error => {\n  console.error(error)\n\n  // Better Cloudflare errors\n  const cloudflareErrors = {\n    520: 'Unknown Error',\n    521: 'Web Server Is Down',\n    522: 'Connection Timed Out',\n    523: 'Origin Is Unreachable',\n    524: 'A Timeout Occurred',\n    525: 'SSL Handshake Failed',\n    526: 'Invalid SSL Certificate',\n    527: 'Railgun Error',\n    530: 'Origin DNS Error'\n  }\n\n  const statusText = cloudflareErrors[error.response.status] || error.response.statusText\n  const description = error.response.data && error.response.data.description\n    ? error.response.data.description\n    : 'There was an error with the request.\\nPlease check the console for more information.'\n\n  return swal(`${error.response.status} ${statusText}`, description, 'error')\n}\n\npage.preparePage = () => {\n  if (page.token) page.verifyToken(page.token, true)\n  else window.location = 'auth'\n}\n\npage.checkClientVersion = apiVersion => {\n  const self = document.querySelector('#mainScript')\n  const match = self.src.match(/\\?_=(\\d+)$/)\n  if (match && match[1] && match[1] !== apiVersion) {\n    return swal({\n      title: 'Update detected!',\n      text: 'Client assets have been updated. Reload to display the latest version?',\n      icon: 'info',\n      buttons: {\n        confirm: {\n          text: 'Reload',\n          closeModal: false\n        }\n      }\n    }).then(() => {\n      window.location.reload()\n    })\n  }\n}\n\npage.verifyToken = (token, reloadOnError) => {\n  axios.post('api/tokens/verify', { token }).then(response => {\n    if (response.data.success === false) {\n      return swal({\n        title: 'An error occurred!',\n        text: response.data.description,\n        icon: 'error'\n      }).then(() => {\n        if (!reloadOnError) return\n        localStorage.removeItem(lsKeys.token)\n        window.location = 'auth'\n      })\n    }\n\n    axios.defaults.headers.common.token = token\n    localStorage[lsKeys.token] = token\n\n    if (response.data.version) {\n      page.checkClientVersion(response.data.version)\n    }\n\n    page.token = token\n    page.username = response.data.username\n    page.permissions = response.data.permissions\n    page.prepareDashboard()\n  }).catch(page.onAxiosError)\n}\n\npage.prepareDashboard = () => {\n  page.section = document.querySelector('#dashboard')\n  page.dom = page.section.querySelector('#page')\n\n  // Capture all click events\n  page.dom.addEventListener('click', page.domClick, true)\n\n  // Capture all submit events\n  page.dom.addEventListener('submit', event => {\n    // Prevent default if necessary\n    if (event.target && event.target.classList.contains('prevent-default')) {\n      return event.preventDefault()\n    }\n  }, true)\n\n  page.menusContainer = document.querySelector('#menu')\n\n  // All item menus in the sidebar\n  const itemMenus = [\n    { selector: '#itemUploads', onclick: page.getUploads },\n    { selector: '#itemDeleteUploadsByNames', onclick: page.deleteUploadsByNames },\n    { selector: '#itemManageYourAlbums', onclick: page.getAlbums },\n    { selector: '#itemManageToken', onclick: page.changeToken },\n    { selector: '#itemChangePassword', onclick: page.changePassword },\n    { selector: '#itemLogout', onclick: page.logout },\n    { selector: '#itemManageUploads', onclick: page.getUploads, params: { all: true }, group: 'moderator' },\n    { selector: '#itemManageAlbums', onclick: page.getAlbums, params: { all: true }, group: 'moderator' },\n    { selector: '#itemStatistics', onclick: page.getStatistics, group: 'admin' },\n    { selector: '#itemManageUsers', onclick: page.getUsers, group: 'admin' }\n  ]\n\n  for (let i = 0; i < itemMenus.length; i++) {\n    // Skip item menu if not enough permission\n    if (itemMenus[i].group && !page.permissions[itemMenus[i].group]) continue\n\n    // Add onclick event listener\n    const item = document.querySelector(itemMenus[i].selector)\n    item.addEventListener('click', event => {\n      if (page.isSomethingLoading) return page.warnSomethingLoading()\n\n      // eslint-disable-next-line compat/compat\n      itemMenus[i].onclick.call(null, Object.assign(itemMenus[i].params || {}, {\n        trigger: event.currentTarget,\n        forceScroll: true\n      }))\n    })\n\n    item.classList.remove('is-hidden')\n    page.menus.push(item)\n  }\n\n  // If at least a moderator, show administration section\n  if (page.permissions.moderator) {\n    document.querySelector('#itemLabelAdmin').classList.remove('is-hidden')\n    document.querySelector('#itemListAdmin').classList.remove('is-hidden')\n  }\n\n  // Update text of logout button\n  document.querySelector('#itemLogout').innerHTML = `Logout ( ${page.username} )`\n\n  // Finally display dashboard\n  page.unhide()\n\n  // Load albums sidebar\n  page.getAlbumsSidebar()\n\n  if (typeof page.prepareShareX === 'function') page.prepareShareX()\n}\n\npage.logout = params => {\n  page.updateTrigger(params.trigger, 'active')\n  localStorage.removeItem(lsKeys.token)\n  window.location = 'auth'\n}\n\npage.warnSomethingLoading = () => {\n  swal('Please wait!', 'Something else is still loading\\u2026', 'warning', {\n    buttons: false,\n    timer: 3000\n  })\n}\n\npage.updateTrigger = (trigger, newState) => {\n  if (!trigger) return\n\n  // Disable menus container and pagination when loading\n  if (newState === 'loading') {\n    page.isSomethingLoading = true\n    page.section.classList.add('is-loading')\n  } else {\n    page.section.classList.remove('is-loading')\n    page.isSomethingLoading = false\n  }\n\n  if (newState === 'loading') {\n    trigger.classList.add('is-loading')\n  } else if (newState === 'active') {\n    if (trigger.parentNode.tagName === 'LI' && !trigger.className.includes('pagination-link')) {\n      for (let i = 0; i < page.menus.length; i++) {\n        page.menus[i].classList.remove('is-active')\n      }\n      trigger.classList.add('is-active')\n    }\n    trigger.classList.remove('is-loading')\n  } else {\n    trigger.classList.remove('is-loading')\n    trigger.classList.remove('is-active')\n  }\n}\n\npage.getItemID = element => {\n  // This expects the item's parent to have the item's ID\n  let parent = element.parentNode\n  // If the element is part of a set of controls, use the container's parent instead\n  if (element.parentNode.classList.contains('controls')) parent = parent.parentNode\n  return parseInt(parent.dataset.id)\n}\n\npage.domClick = event => {\n  // We are processing clicks this way to avoid using \"onclick\" attribute\n  // Apparently we will need to use \"unsafe-inline\" for \"script-src\" directive\n  // of Content Security Policy (CSP), if we want to use \"onclick\" attribute\n  // Though I think that only applies to some browsers (?)\n  // Of course it wouldn't have mattered if we didn't use CSP to begin with\n  // Anyway, I personally would rather not use \"onclick\" attribute\n  let element = event.target\n  if (!element) return\n\n  // Delegate click events to their A or BUTTON parents\n  if (['I'].includes(element.tagName) && ['SPAN'].includes(element.parentNode.tagName)) {\n    element = element.parentNode\n  }\n  if (['SPAN'].includes(element.tagName) && ['A', 'BUTTON'].includes(element.parentNode.tagName)) {\n    element = element.parentNode\n  }\n\n  // Skip elements that have no action data\n  if (!element.dataset || !element.dataset.action) return\n\n  // Skip disabled elements\n  if (element.hasAttribute('disabled')) return\n\n  event.stopPropagation() // maybe necessary\n  const id = page.getItemID(element)\n  const action = element.dataset.action\n\n  switch (action) {\n    // Uploads\n    case 'view-list':\n      return page.setUploadsView('list', element)\n    case 'view-thumbs':\n      return page.setUploadsView('thumbs', element)\n    case 'toggle-original-names':\n      return page.toggleOriginalNames(element)\n    case 'add-to-album':\n      return page.addToAlbum(id)\n    case 'delete-upload':\n      return page.deleteUpload(id)\n    case 'add-selected-uploads-to-album':\n      return page.addSelectedUploadsToAlbum()\n    case 'bulk-delete-uploads':\n      return page.bulkDeleteUploads()\n    case 'display-preview':\n      return page.displayPreview(id)\n    // Manage uploads\n    case 'upload-filters-help':\n      return page.uploadFiltersHelp(element)\n    case 'filter-uploads':\n      return page.filterUploads(element)\n    // Manage your albums\n    case 'submit-album':\n      return page.submitAlbum(element)\n    case 'edit-album':\n      return page.editAlbum(id)\n    case 'disable-album':\n      return page.disableAlbum(id)\n    case 'view-album-uploads':\n      return page.viewAlbumUploads(id, element)\n    // Manage users\n    case 'create-user':\n      return page.createUser()\n    case 'edit-user':\n      return page.editUser(id)\n    case 'disable-user':\n      return page.disableUser(id)\n    case 'delete-user':\n      return page.deleteUser(id)\n    case 'view-user-uploads':\n      return page.viewUserUploads(id, element)\n    // Others\n    case 'get-new-token':\n      return page.getNewToken(element)\n    // Uploads & Users\n    case 'clear-selection':\n      return page.clearSelection()\n    case 'select':\n      return page.select(element, event)\n    case 'select-all':\n      return page.selectAll(element)\n    case 'page-ellipsis':\n      return page.focusJumpToPage(element)\n    case 'page-prev':\n    case 'page-next':\n    case 'page-goto':\n    case 'jump-to-page':\n      return page.switchPage(action, element)\n  }\n}\n\npage.fadeInDom = disableFading => {\n  if (page.fadingIn) {\n    clearTimeout(page.fadingIn)\n    page.dom.classList.remove('fade-in')\n  }\n\n  if (!disableFading) {\n    page.dom.classList.add('fade-in')\n    page.fadingIn = setTimeout(() => {\n      page.dom.classList.remove('fade-in')\n    }, 500)\n  }\n}\n\npage.scrollToDom = disableSmooth => {\n  page.dom.scrollIntoView({\n    behavior: disableSmooth ? 'auto' : 'smooth',\n    block: 'start',\n    inline: 'nearest'\n  })\n}\n\npage.getByView = (view, get) => {\n  switch (view) {\n    case 'uploads':\n    case 'uploadsAll':\n      return {\n        type: 'uploads',\n        func: page.getUploads\n      }[get]\n    case 'albums':\n    case 'albumsAll':\n      return {\n        type: 'albums',\n        func: page.getAlbums\n      }[get]\n    case 'users':\n      return {\n        type: 'users',\n        func: page.getUsers\n      }[get]\n    default:\n      return null\n  }\n}\n\npage.switchPage = (action, element) => {\n  if (page.isSomethingLoading) return page.warnSomethingLoading()\n\n  // eslint-disable-next-line compat/compat\n  const params = Object.assign(page.views[page.currentView], {\n    trigger: element\n  })\n\n  const func = page.getByView(page.currentView, 'func')\n\n  switch (action) {\n    case 'page-prev':\n      params.pageNum = page.views[page.currentView].pageNum - 1\n      if (params.pageNum < 0) {\n        return swal('An error occurred!', 'This is already the first page.', 'error')\n      }\n      return func(params)\n    case 'page-next':\n      params.pageNum = page.views[page.currentView].pageNum + 1\n      return func(params)\n    case 'page-goto':\n      params.pageNum = parseInt(element.dataset.goto)\n      return func(params)\n    case 'jump-to-page': {\n      const jumpToPage = document.querySelector(`#${element.dataset.jumpid || 'jumpToPage'}`)\n      if (!jumpToPage.checkValidity()) return\n      const parsed = parseInt(jumpToPage.value)\n      params.pageNum = isNaN(parsed) ? 0 : (parsed - 1)\n      if (params.pageNum < 0) params.pageNum = 0\n      return func(params)\n    }\n  }\n}\n\npage.focusJumpToPage = element => {\n  const jumpToPage = document.querySelector(`#${element.dataset.jumpid || 'jumpToPage'}`)\n  if (!jumpToPage) return\n  jumpToPage.focus()\n  jumpToPage.select()\n}\n\npage.getUploads = (params = {}) => {\n  if (params && params.all && !page.permissions.moderator) {\n    return swal('An error occurred!', 'You cannot do this!', 'error')\n  }\n\n  if (page.isSomethingLoading) return page.warnSomethingLoading()\n\n  page.updateTrigger(params.trigger, 'loading')\n\n  if (typeof params.pageNum !== 'number' || params.pageNum < 0) {\n    params.pageNum = 0\n  }\n\n  const url = typeof params.album !== 'undefined'\n    ? `api/album/${params.album}/${params.pageNum}`\n    : `api/uploads/${params.pageNum}`\n\n  const headers = {}\n  if (params.all) headers.all = '1'\n  if (params.filters) {\n    headers.filters = params.filters\n    // Send client timezone offset if properly using date: and/or :expiry filters\n    // Server will pretend client is on UTC if unset\n    if (/(^|\\s)(date|expiry):[\\d\"]/.test(params.filters)) {\n      headers.minoffset = new Date().getTimezoneOffset()\n    }\n  }\n\n  axios.get(url, { headers }).then(response => {\n    if (response.data.success === false) {\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n    }\n\n    const pages = Math.ceil(response.data.count / 25)\n    const files = response.data.files\n    if (params.pageNum && (files.length === 0)) {\n      page.updateTrigger(params.trigger)\n      if (params.autoPage) {\n        params.pageNum = pages - 1\n        return page.getUploads(params)\n      } else {\n        return swal('An error occurred!', `There are no more uploads to populate page ${params.pageNum + 1}.`, 'error')\n      }\n    }\n\n    page.currentView = params.all ? 'uploadsAll' : 'uploads'\n    page.cache = {}\n\n    const albums = response.data.albums\n    const users = response.data.users\n    const basedomain = response.data.basedomain\n\n    if (params.pageNum < 0) params.pageNum = Math.max(0, pages + params.pageNum)\n    const pagination = page.paginate(response.data.count, 25, params.pageNum)\n\n    const filter = `\n      <div class=\"column\">\n        <form class=\"prevent-default\">\n          <div class=\"field has-addons\">\n            <div class=\"control is-expanded\">\n              <input id=\"filters\" class=\"input is-small\" type=\"text\" placeholder=\"Filter uploads\" value=\"${page.escape(params.filters || '')}\">\n            </div>\n            <div class=\"control\">\n              <button type=\"button\" class=\"button is-small is-primary is-outlined\" title=\"Help?\" data-action=\"upload-filters-help\"${params.all ? ' data-all=\"true\"' : ''}>\n                <span class=\"icon\">\n                  <i class=\"icon-help-circled\"></i>\n                </span>\n              </button>\n            </div>\n            <div class=\"control\">\n              <button type=\"submit\" class=\"button is-small is-info is-outlined\" title=\"Filter uploads\" data-action=\"filter-uploads\">\n                <span class=\"icon\">\n                  <i class=\"icon-filter\"></i>\n                </span>\n              </button>\n            </div>\n          </div>\n        </form>\n      </div>\n    `\n    const extraControls = `\n      <div class=\"columns\">\n        ${filter}\n        <div class=\"column is-one-quarter\">\n          <form class=\"prevent-default\">\n            <div class=\"field has-addons\">\n              <div class=\"control is-expanded\">\n                <input id=\"jumpToPage\" class=\"input is-small\" type=\"number\" min=\"1\" max=\"${pages}\" value=\"${params.pageNum + 1}\"${pages === 1 ? ' disabled' : ''}>\n              </div>\n              <div class=\"control\">\n                <button type=\"submit\" class=\"button is-small is-info is-outlined\" title=\"Jump to page\" data-action=\"jump-to-page\">\n                  <span class=\"icon\">\n                    <i class=\"icon-paper-plane\"></i>\n                  </span>\n                </button>\n              </div>\n            </div>\n          </form>\n        </div>\n      </div>\n    `\n\n    const controls = `\n      <div class=\"columns\">\n        <div class=\"column exclusive-operations has-text-left\">\n          <a class=\"button is-small is-primary is-outlined\" title=\"Toggle original names\" data-action=\"toggle-original-names\">\n            <span class=\"icon\">\n              <i class=\"icon-exchange\"></i>\n            </span>\n            <span>Toggle original names</span>\n          </a>\n        </div>\n        <div class=\"column has-text-centered\">\n          <a class=\"button is-small is-danger is-outlined\" title=\"List view\" data-action=\"view-list\">\n            <span class=\"icon\">\n              <i class=\"icon-th-list\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-danger is-outlined\" title=\"Thumbs view\" data-action=\"view-thumbs\">\n            <span class=\"icon\">\n              <i class=\"icon-th-large\"></i>\n            </span>\n          </a>\n        </div>\n        <div class=\"column bulk-operations has-text-right\">\n          <a class=\"button is-small is-info is-outlined\" title=\"Clear selection\" data-action=\"clear-selection\">\n            <span class=\"icon\">\n              <i class=\"icon-cancel\"></i>\n            </span>\n          </a>\n          ${params.all\n            ? ''\n            : `<a class=\"button is-small is-warning is-outlined\" title=\"Bulk add to album\" data-action=\"add-selected-uploads-to-album\">\n            <span class=\"icon\">\n              <i class=\"icon-plus\"></i>\n            </span>\n          </a>`}\n          <a class=\"button is-small is-danger is-outlined\" title=\"Bulk delete\" data-action=\"bulk-delete-uploads\">\n            <span class=\"icon\">\n              <i class=\"icon-trash\"></i>\n            </span>\n            <span>Bulk delete</span>\n          </a>\n        </div>\n      </div>\n    `\n\n    // Do some string replacements for bottom controls\n    const bottomFiltersId = 'bFilters'\n    const bottomJumpId = 'bJumpToPage'\n    const bottomExtraControls = extraControls\n      .replace(/id=\"filters\"/, `id=\"${bottomFiltersId}\"`)\n      .replace(/(data-action=\"filter-uploads\")/, `$1 data-filtersid=\"${bottomFiltersId}\"`)\n      .replace(/id=\"jumpToPage\"/, `id=\"${bottomJumpId}\"`)\n      .replace(/(data-action=\"jump-to-page\")/g, `$1 data-jumpid=\"${bottomJumpId}\"`)\n    const bottomPagination = pagination\n      .replace(/(data-action=\"page-ellipsis\")/g, `$1 data-jumpid=\"${bottomJumpId}\"`)\n\n    // Whether there are any unselected items\n    let unselected = false\n\n    const showOriginalNames = page.views[page.currentView].originalNames\n    const hasExpiryDateColumn = files.some(file => typeof file.expirydate !== 'undefined')\n\n    for (let i = 0; i < files.length; i++) {\n      // Build full URLs\n      files[i].file = `${basedomain}/${files[i].name}`\n      if (files[i].thumb) {\n        files[i].thumb = `${basedomain}/${files[i].thumb}`\n      }\n\n      // Determine types\n      files[i].type = 'other'\n      const exec = /.[\\w]+(\\?|$)/.exec(files[i].file)\n      const extname = exec && exec[0] ? exec[0].toLowerCase() : null\n      if (page.imageExts.includes(extname)) {\n        files[i].type = 'picture'\n      } else if (page.videoExts.includes(extname)) {\n        files[i].type = 'video'\n      } else if (page.audioExts.includes(extname)) {\n        files[i].type = 'audio'\n      }\n\n      files[i].previewable = files[i].thumb || files[i].type === 'audio'\n\n      // Cache bare minimum data for thumbnails viewer\n      page.cache[files[i].id] = {\n        name: files[i].name,\n        original: files[i].original,\n        thumb: files[i].thumb,\n        file: files[i].file,\n        type: files[i].type,\n        previewable: files[i].previewable\n      }\n\n      // Prettify\n      files[i].prettyBytes = page.getPrettyBytes(parseInt(files[i].size))\n      files[i].prettyDate = page.getPrettyDate(new Date(files[i].timestamp * 1000))\n\n      if (hasExpiryDateColumn) {\n        files[i].prettyExpiryDate = files[i].expirydate\n          ? page.getPrettyDate(new Date(files[i].expirydate * 1000))\n          : null\n      }\n\n      // Update selected status\n      files[i].selected = page.selected[page.currentView].includes(files[i].id)\n      if (!files[i].selected) unselected = true\n\n      // Appendix (display album or user)\n      if (params.all) {\n        files[i].appendix = files[i].userid\n          ? users[files[i].userid] || ''\n          : ''\n      } else if (typeof params.album === 'undefined') {\n        files[i].appendix = files[i].albumid\n          ? albums[files[i].albumid] || ''\n          : ''\n      }\n    }\n\n    if (page.views[page.currentView].type === 'thumbs') {\n      page.dom.innerHTML = `\n        ${pagination}\n        ${extraControls}\n        ${controls}\n        <div id=\"table\" class=\"columns is-multiline is-mobile is-centered\">\n        </div>\n        ${controls}\n        ${bottomExtraControls}\n        ${bottomPagination}\n      `\n\n      const table = document.querySelector('#table')\n\n      for (let i = 0; i < files.length; i++) {\n        const upload = files[i]\n        const div = document.createElement('div')\n        div.className = 'image-container column'\n        div.dataset.id = upload.id\n\n        if (typeof upload.thumb !== 'undefined') {\n          div.innerHTML = `<a class=\"image\" href=\"${upload.file}\" target=\"_blank\"><img alt=\"${upload.name}\" data-src=\"${upload.thumb}\"/></a>`\n        } else {\n          div.innerHTML = `<a class=\"image\" href=\"${upload.file}\" target=\"_blank\"><h1 class=\"title\">${upload.extname || 'N/A'}</h1></a>`\n        }\n\n        div.innerHTML += `\n          <input type=\"checkbox\" class=\"checkbox\" title=\"Select\" data-index=\"${i}\" data-action=\"select\"${upload.selected ? ' checked' : ''}>\n          <div class=\"controls\">\n            ${upload.previewable\n              ? `<a class=\"button is-small is-primary\" title=\"Display preview\" data-action=\"display-preview\">\n              <span class=\"icon\">\n                <i class=\"${upload.type !== 'other' ? `icon-${upload.type}` : 'icon-doc-inv'}\"></i>\n              </span>\n            </a>`\n              : ''}\n            <a class=\"button is-small is-info clipboard-js\" title=\"Copy link to clipboard\" data-clipboard-text=\"${upload.file}\">\n              <span class=\"icon\">\n                <i class=\"icon-clipboard\"></i>\n              </span>\n            </a>\n            <a class=\"button is-small is-warning\" title=\"Add to album\" data-action=\"add-to-album\">\n              <span class=\"icon\">\n                <i class=\"icon-plus\"></i>\n              </span>\n            </a>\n            <a class=\"button is-small is-danger\" title=\"Delete\" data-action=\"delete-upload\">\n              <span class=\"icon\">\n                <i class=\"icon-trash\"></i>\n              </span>\n            </a>\n          </div>\n          <div class=\"details\">\n            <p class=\"name\" title=\"${upload.file}\">${upload.name}</p>\n            ${showOriginalNames ? `<p class=\"originalname\" title=\"${upload.original}\">${upload.original}</p>` : ''}\n            <p class=\"prettybytes\">${upload.appendix ? `<span>${upload.appendix}</span>  ` : ''}${upload.prettyBytes}</p>\n            ${hasExpiryDateColumn && upload.prettyExpiryDate\n              ? `<p class=\"prettyexpirydate\">EXP: ${upload.prettyExpiryDate}</p>`\n              : ''}\n          </div>\n        `\n\n        table.appendChild(div)\n        page.checkboxes = table.querySelectorAll('.checkbox[data-action=\"select\"]')\n      }\n    } else {\n      const allAlbums = params.all && params.filters && params.filters.includes('albumid:')\n      page.dom.innerHTML = `\n        ${pagination}\n        ${extraControls}\n        ${controls}\n        <div class=\"table-container has-text-left\">\n          <table class=\"table is-narrow is-fullwidth is-hoverable\">\n            <thead>\n              <tr>\n                <th class=\"controls\"><input id=\"selectAll\" class=\"checkbox\" type=\"checkbox\" title=\"Select all\" data-action=\"select-all\"></th>\n                <th title=\"Key: name\">File name</th>\n                ${showOriginalNames ? '<th title=\"Key: original\">Original name</th>' : ''}\n                ${typeof params.album === 'undefined' ? `<th title=\"Key: ${params.all ? 'userid\">User' : 'albumid\">Album'}</th>` : ''}\n                ${allAlbums ? '<th title=\"Key: albumid\">Album</th>' : ''}\n                <th title=\"Key: size\">Size</th>\n                ${params.all ? '<th title=\"Key: ip\">IP</th>' : ''}\n                <th title=\"Key: timestamp\">Upload date</th>\n                ${hasExpiryDateColumn ? '<th title=\"Key: expirydate\">Expiry date</th>' : ''}\n                <th class=\"has-text-right\">(${response.data.count} total)</th>\n              </tr>\n            </thead>\n            <tbody id=\"table\">\n            </tbody>\n          </table>\n        </div>\n        ${controls}\n        ${bottomExtraControls}\n        ${bottomPagination}\n      `\n\n      const table = document.querySelector('#table')\n\n      for (let i = 0; i < files.length; i++) {\n        const upload = files[i]\n        const tr = document.createElement('tr')\n        tr.dataset.id = upload.id\n        tr.innerHTML = `\n          <td class=\"controls\"><input type=\"checkbox\" class=\"checkbox\" title=\"Select\" data-index=\"${i}\" data-action=\"select\"${upload.selected ? ' checked' : ''}></td>\n          <th class=\"name\"><a href=\"${upload.file}\" target=\"_blank\" title=\"${upload.file}\">${upload.name}</a></th>\n          ${showOriginalNames ? `<th class=\"originalname\" title=\"${upload.original}\">${upload.original}</th>` : ''}\n          ${typeof params.album === 'undefined' ? `<th class=\"appendix\">${upload.appendix}</th>` : ''}\n          ${allAlbums ? `<th class=\"album\">${upload.albumid ? (albums[upload.albumid] || '') : ''}</th>` : ''}\n          <td class=\"prettybytes\">${upload.prettyBytes}</td>\n          ${params.all ? `<td class=\"ip\">${upload.ip || ''}</td>` : ''}\n          <td class=\"prettydate\">${upload.prettyDate}</td>\n          ${hasExpiryDateColumn ? `<td class=\"prettyexpirydate\">${upload.prettyExpiryDate || '-'}</td>` : ''}\n          <td class=\"controls has-text-right\">\n            <a class=\"button is-small is-primary is-outlined\" title=\"${upload.previewable ? 'Display preview' : 'File can\\'t be previewed'}\" data-action=\"display-preview\"${upload.previewable ? '' : ' disabled'}>\n              <span class=\"icon\">\n                <i class=\"${upload.type !== 'other' ? `icon-${upload.type}` : 'icon-doc-inv'}\"></i>\n              </span>\n            </a>\n            <a class=\"button is-small is-info is-outlined clipboard-js\" title=\"Copy link to clipboard\" data-clipboard-text=\"${upload.file}\">\n              <span class=\"icon\">\n                <i class=\"icon-clipboard\"></i>\n              </span>\n            </a>\n            ${params.all\n              ? ''\n              : `<a class=\"button is-small is-warning is-outlined\" title=\"Add to album\" data-action=\"add-to-album\">\n              <span class=\"icon\">\n                <i class=\"icon-plus\"></i>\n              </span>\n            </a>`}\n            <a class=\"button is-small is-danger is-outlined\" title=\"Delete\" data-action=\"delete-upload\">\n              <span class=\"icon\">\n                <i class=\"icon-trash\"></i>\n              </span>\n            </a>\n          </td>\n        `\n\n        table.appendChild(tr)\n        page.checkboxes = table.querySelectorAll('.checkbox[data-action=\"select\"]')\n      }\n    }\n\n    const selectAll = document.querySelector('#selectAll')\n    if (selectAll && !unselected && files.length) {\n      selectAll.checked = true\n      selectAll.title = 'Unselect all'\n    }\n\n    page.fadeInDom()\n\n    const pageNum = files.length ? params.pageNum : 0\n    if (params.forceScroll ||\n      page.prevPageNums[page.currentView] === null ||\n      page.prevPageNums[page.currentView] !== pageNum) {\n      const disableSmooth = !params.forceScroll && page.views[page.currentView].type === 'thumbs'\n      page.scrollToDom(disableSmooth)\n    }\n\n    if (page.views[page.currentView].type === 'thumbs') {\n      page.lazyLoad.update()\n    }\n\n    page.updateTrigger(params.trigger, 'active')\n\n    if (page.currentView === 'uploads') {\n      page.views.uploads.album = params.album\n    }\n    page.views[page.currentView].filters = params.filters\n    page.views[page.currentView].pageNum = page.prevPageNums[page.currentView] = pageNum\n  }).catch(error => {\n    page.updateTrigger(params.trigger)\n    page.onAxiosError(error)\n  })\n}\n\npage.setUploadsView = (view, element) => {\n  if (page.isSomethingLoading) return page.warnSomethingLoading()\n\n  if (view === 'list') {\n    delete localStorage[lsKeys.viewType[page.currentView]]\n    page.views[page.currentView].type = undefined\n  } else {\n    localStorage[lsKeys.viewType[page.currentView]] = view\n    page.views[page.currentView].type = view\n  }\n\n  // eslint-disable-next-line compat/compat\n  page.getUploads(Object.assign(page.views[page.currentView], {\n    trigger: element\n  }))\n}\n\npage.toggleOriginalNames = element => {\n  if (page.isSomethingLoading) return page.warnSomethingLoading()\n\n  if (page.views[page.currentView].originalNames) {\n    delete localStorage[lsKeys.originalNames[page.currentView]]\n    page.views[page.currentView].originalNames = false\n  } else {\n    localStorage[lsKeys.originalNames[page.currentView]] = '1'\n    page.views[page.currentView].originalNames = true\n  }\n\n  // eslint-disable-next-line compat/compat\n  page.getUploads(Object.assign(page.views[page.currentView], {\n    trigger: element\n  }))\n}\n\npage.displayPreview = id => {\n  const file = page.cache[id]\n  if (!file.previewable) return\n\n  const div = document.createElement('div')\n  div.innerHTML = `\n    <div class=\"content has-text-centered\">\n      <p>\n        <div class=\"has-text-weight-bold\">${file.name}</div>\n        <div>${file.original}</div>\n      </p>\n      ${file.thumb\n        ? `<p class=\"swal-display-thumb-container\">\n        <img id=\"swalThumb\" src=\"${file.thumb}\">\n      </p>`\n        : ''}\n    </div>\n  `\n\n  if (file.file) {\n    const exec = /.[\\w]+(\\?|$)/.exec(file.file)\n    const extname = exec && exec[0] ? exec[0].toLowerCase() : null\n    const isimage = page.imageExts.includes(extname)\n    const isvideo = !isimage && page.videoExts.includes(extname)\n    const isaudio = !isimage && !isvideo && page.audioExts.includes(extname)\n\n    if (isimage || isvideo || isaudio) {\n      div.innerHTML += `\n        <div class=\"field has-text-centered\">\n          <div class=\"controls\">\n            <a id=\"swalOriginal\" type=\"button\" class=\"button is-info\">\n              <span class=\"icon\">\n                <i class=\"icon-${file.type}\"></i>\n              </span>\n              <span>${isimage ? 'Load original' : 'Play in embedded player'}</span>\n            </a>\n          </div>\n        </div>\n      `\n\n      if (isimage) {\n        div.querySelector('#swalOriginal').addEventListener('click', event => {\n          const trigger = event.currentTarget\n          if (trigger.classList.contains('is-danger')) return\n\n          trigger.classList.add('is-loading')\n          const thumb = div.querySelector('#swalThumb')\n\n          thumb.src = file.file\n          thumb.onload = () => {\n            trigger.classList.add('is-hidden')\n            document.body.querySelector('.swal-overlay .swal-modal:not(.is-expanded)').classList.add('is-expanded')\n          }\n          thumb.onerror = event => {\n            event.currentTarget.classList.add('is-hidden')\n            trigger.className = 'button is-danger is-fullwidth'\n            trigger.innerHTML = `\n              <span class=\"icon\">\n                <i class=\"icon-block\"></i>\n              </span>\n              <span>Unable to load original</span>\n            `\n          }\n        })\n      } else if (isvideo || isaudio) {\n        const match = file.file.match(/.*\\/(.*)$/)\n        console.log(file.file, match)\n        if (match || match[1]) {\n          div.querySelector('#swalOriginal').setAttribute('href', `v/${match[1]}`)\n          div.querySelector('#swalOriginal').setAttribute('target', '_blank')\n        }\n      }\n    }\n  }\n\n  return swal({\n    content: div,\n    buttons: false\n  }).then(() => {\n    // Restore modal size\n    document.body.querySelector('.swal-overlay .swal-modal').classList.remove('is-expanded')\n  })\n}\n\npage.selectAll = element => {\n  for (let i = 0; i < page.checkboxes.length; i++) {\n    const id = page.getItemID(page.checkboxes[i])\n    if (isNaN(id)) continue\n    if (page.checkboxes[i].checked !== element.checked) {\n      page.checkboxes[i].checked = element.checked\n      if (page.checkboxes[i].checked) {\n        page.selected[page.currentView].push(id)\n      } else {\n        page.selected[page.currentView].splice(page.selected[page.currentView].indexOf(id), 1)\n      }\n    }\n  }\n\n  if (page.selected[page.currentView].length) {\n    localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n  } else {\n    delete localStorage[lsKeys.selected[page.currentView]]\n  }\n\n  element.title = element.checked ? 'Unselect all' : 'Select all'\n}\n\npage.selectInBetween = (element, lastElement) => {\n  const thisIndex = parseInt(element.dataset.index)\n  const lastIndex = parseInt(lastElement.dataset.index)\n\n  const distance = Math.abs(thisIndex - lastIndex)\n  if (distance < 2) return\n\n  for (let i = 0; i < page.checkboxes.length; i++) {\n    if ((thisIndex > lastIndex && i > lastIndex && i < thisIndex) ||\n      (thisIndex < lastIndex && i > thisIndex && i < lastIndex)) {\n      // Check or uncheck depending on the state of the initial checkbox\n      const checked = page.checkboxes[i].checked = lastElement.checked\n      const id = page.getItemID(page.checkboxes[i])\n      if (!page.selected[page.currentView].includes(id) && checked) {\n        page.selected[page.currentView].push(id)\n      } else if (page.selected[page.currentView].includes(id) && !checked) {\n        page.selected[page.currentView].splice(page.selected[page.currentView].indexOf(id), 1)\n      }\n    }\n  }\n}\n\npage.select = (element, event) => {\n  const id = page.getItemID(element)\n  if (isNaN(id)) return\n\n  if (event.shiftKey && page.lastSelected) {\n    page.selectInBetween(element, page.lastSelected)\n    // Check or uncheck depending on the state of the initial checkbox\n    element.checked = page.lastSelected.checked\n  } else {\n    page.lastSelected = element\n  }\n\n  if (!page.selected[page.currentView].includes(id) && element.checked) {\n    page.selected[page.currentView].push(id)\n  } else if (page.selected[page.currentView].includes(id) && !element.checked) {\n    page.selected[page.currentView].splice(page.selected[page.currentView].indexOf(id), 1)\n  }\n\n  // Update local storage\n  if (page.selected[page.currentView].length) {\n    localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n  } else {\n    delete localStorage[lsKeys.selected[page.currentView]]\n  }\n}\n\npage.clearSelection = () => {\n  const selected = page.selected[page.currentView]\n  const type = page.getByView(page.currentView, 'type')\n  const count = selected.length\n  if (!count) return swal('An error occurred!', `You have not selected any ${type}.`, 'error')\n\n  const suffix = count === 1 ? type.substring(0, type.length - 1) : type\n  return swal({\n    title: 'Are you sure?',\n    text: `You are going to unselect ${count} ${suffix}.`,\n    buttons: true\n  }).then(proceed => {\n    if (!proceed) return\n\n    const checkboxes = page.checkboxes\n    for (let i = 0; i < checkboxes.length; i++) {\n      if (checkboxes[i].checked) {\n        checkboxes[i].checked = false\n      }\n    }\n\n    page.selected[page.currentView] = []\n    delete localStorage[lsKeys.selected[page.currentView]]\n\n    const selectAll = document.querySelector('#selectAll')\n    if (selectAll) selectAll.checked = false\n\n    return swal('Cleared selection!', `Unselected ${count} ${suffix}.`, 'success')\n  })\n}\n\npage.uploadFiltersHelp = element => {\n  const all = Boolean(element.dataset.all)\n  const content = document.createElement('div')\n  content.style = 'text-align: left'\n  content.innerHTML = `${all\n    ? `There are 2 filter keys, namely <b>user</b> (username) and <b>ip</b>.\n    These keys can be specified more than once.\n    For usernames with whitespaces, wrap them with double quotes (<code>\"</code>).\n    Special cases such as uploads by non-registered users or have no IPs respectively, use <code>user:-</code> or <code>ip:-</code>.\n\n    To exclude certain users/ips while still listing every other uploads, add negation sign (<code>-</code>) before the keys.\n    Negation sign can also be used to exclude the special cases mentioned above (i.e. <code>-user:-</code> or <code>-ip:-</code>).\n\n    If you know the ID of a user's album, you can list its uploads with <b>albumid</b> key.\n    Negation sign works for this key as well.`\n    : `There is only 1 filter key, namely <b>albumid</b>.\n    This key can be specified more than once.\n    Special case such as uploads with no albums, use <code>albumid:-</code>.\n\n    To exclude certain albums while still listing every other uploads, add negation sign (<code>-</code>) before the keys.\n    Negation sign can also be used to exclude the special case mentioned above (i.e. <code>-albumid:-</code>).`}\n\n    There are 2 range keys: <b>date</b> (upload date) and <b>expiry</b> (expiry date).\n    Their format is: <code>\"YYYY/MM/DD HH:MM:SS-YYYY/MM/DD HH:MM:SS\"</code> (\"from\" date and \"to\" date respectively).\n    You may specify only one of the dates.\n    If \"to\" date is missing, 'now' will be used. If \"from\" date is missing, 'beginning of time' will be used.\n    If any of the subsequent date or time units are not specified, their first value will be used (e.g. January for month, 1 for day, and so on).\n    If only time is specified, today's date will be used.\n    If you do not need to specify both date and time, you may omit the double quotes.\n    In conclusion, the following examples are all valid: <code>date:\"2020/01/01 01:23-2018/01/01 06\"</code>, <code>expiry:-2020/05</code>, <code>date:12:34:56</code>.\n    These keys can only be specified once each.\n\n    <b>Timezone?</b> Feel free to query the dates with your own timezone.\n    API requests to the filter endpoint will attach your browser's timezone offset, so the server will automatically calculate timezone differences.\n\n    Matches can also be sorted with <b>sort</b> keys.\n    Their formats are: <code>sort:columnName[:d[escending]]</code>, where <code>:d[escending]</code> is an optional tag to set the direction to descending.\n    This key must be used with internal column names used in the database (<code>id</code>, <code>${all ? 'userid' : 'albumid'}</code>, and so on),\n    but there are 2 shortcuts available: <b>date</b> for <code>timestamp</code> column and <b>expiry</b> for <code>expirydate</code> column.\n    This key can also be specified more than once, where their order will decide the sorting steps.\n\n    Finally, there are type-<b>is</b> keys to refine by types.\n    You can use <code>is:image</code>, <code>is:video</code>, and <code>is:audio</code> to list images, videos, audios respectively.\n    This will only use image, video and audio extensions that are whitelisted internally in the safe.\n    For images and videos specifically, they will be the ones whose thumbnails can be generated by the safe.\n    Negation sign works for this key as well.\n    Mixing inclusion and exclusion is not allowed (i.e. <code>is:image -is:video</code>, since the second key is redundant).\n\n    Any leftover keywords which do not use keys (non-keyed keywords) will be matched against the matches' file names.\n    Excluding certain keywords is also supported by adding negation sign before the keywords.\n\n    <b>Internal steps:</b>\n    ${all\n      ? `- Query uploads passing ALL exclusion filter keys OR matching ANY filter keys, if any.\n    - Refine matches`\n      : '- Filter uploads'} using date key, if any.\n    - Refine matches using expiry key, if any.\n    - Refine matches using type-is keys, if any.\n    - Refine matches using ANY non-keyed keywords, if any.\n    - Filter matches using ALL exclusion non-keyed keywords, if any.\n    - Sort matches using sorting keys, if any.\n\n    <b>Examples:</b>\n    ${all\n      ? `- Uploads from users named \"demo\" AND/OR \"John Doe\" AND/OR non-registered users:\n    <code>user:demo user:\"John Doe\" user:-</code>\n    - ALL uploads, but NOT the ones from user named \"demo\" AND \"John Doe\":\n    <code>-user:demo -user:\"John Doe\"</code>\n    - Uploads from IP \"127.0.0.1\" AND which file names match \"*.rar\" OR \"*.zip\":\n    <code>ip:127.0.0.1 *.rar *.zip</code>\n    `\n      : ''}- Uploads without albums:\n    <code>albumid:-</code>\n    - ALL uploads, but NOT the ones from album with ID 69:\n    <code>-albumid:69</code>\n    - Uploads uploaded since \"1 June 2019 00:00:00\":\n    <code>date:2019/06</code>\n    - Uploads uploaded between \"7 April 2020 12:00:00\" and \"7 April 2020 23:59:59\":\n    <code>date:\"2020/04/07 12-2020/04/07 23:59:59\"</code>\n    - Uploads uploaded before \"5 February 2020 00:00:00\":\n    <code>date:-2020/02/05</code>\n    - Uploads which file names match \"*.gz\" but NOT \"*.tar.gz\":\n    <code>*.gz -*.tar.gz</code>\n    - Sort matches by \"size\" column in ascending and descending order respectively:\n    <code>${all ? 'user:\"John Doe\"' : '*.txt'} sort:size</code>\n    <code>*.mp4 ${all ? 'user:- ' : ''}sort:size:d</code>\n    ${!page.permissions.moderator\n      ? '<b>Notice:</b> Regular users may face some limitations in the amount of keys that can be used at a time.'\n      : ''}\n    <b>Friendly reminder:</b> This window can be scrolled up!\n  `.trim().replace(/^\\s*/g, '').replace(/\\n/g, '<br>')\n\n  swal({ content }).then(() => {\n    // Restore modal size\n    document.body.querySelector('.swal-overlay .swal-modal').classList.remove('is-expanded')\n  })\n\n  // Expand modal size\n  document.body.querySelector('.swal-overlay .swal-modal:not(.is-expanded)').classList.add('is-expanded')\n}\n\npage.filterUploads = element => {\n  const filters = document.querySelector(`#${element.dataset.filtersid || 'filters'}`).value\n    .trim()\n    .replace(/\\t/g, ' ')\n    .replace(/(^|\\s)((albumid|ip|user|date|expiry|is|sort|orderby):)\\s+/g, '$2')\n  // eslint-disable-next-line compat/compat\n  page.getUploads(Object.assign(page.views[page.currentView], {\n    filters,\n    pageNum: 0,\n    trigger: element\n  }))\n}\n\npage.viewUserUploads = (id, element) => {\n  const user = page.cache[id]\n  if (!user) return\n  element.classList.add('is-loading')\n  // Wrap username in quotes if it contains whitespaces\n  const username = user.username.includes(' ')\n    ? `\"${user.username}\"`\n    : user.username\n  page.getUploads({\n    all: true,\n    filters: `user:${username}`,\n    trigger: document.querySelector('#itemManageUploads')\n  })\n}\n\npage.viewAlbumUploads = (id, element) => {\n  if (!page.cache[id]) return\n  element.classList.add('is-loading')\n  // eslint-disable-next-line compat/compat\n  const all = page.currentView === 'albumsAll' && page.permissions.moderator\n  page.getUploads({\n    all,\n    filters: `albumid:${id}`,\n    trigger: all\n      ? document.querySelector('#itemManageUploads')\n      : document.querySelector('#itemUploads')\n  })\n}\n\npage.deleteUpload = id => {\n  page.postBulkDeleteUploads({\n    all: page.currentView === 'uploadsAll',\n    field: 'id',\n    values: [id],\n    cb (failed) {\n      // Remove from remembered checkboxes if necessary\n      if (!failed.length && page.selected[page.currentView].includes(id)) {\n        page.selected[page.currentView].splice(page.selected[page.currentView].indexOf(id), 1)\n      }\n\n      // Update local storage\n      if (page.selected[page.currentView].length) {\n        localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n      } else {\n        delete localStorage[lsKeys.selected[page.currentView]]\n      }\n\n      // Reload upload list\n      // eslint-disable-next-line compat/compat\n      page.getUploads(Object.assign(page.views[page.currentView], {\n        autoPage: true\n      }))\n    }\n  })\n}\n\npage.bulkDeleteUploads = () => {\n  const count = page.selected[page.currentView].length\n  if (!count) return swal('An error occurred!', 'You have not selected any uploads.', 'error')\n\n  page.postBulkDeleteUploads({\n    all: page.currentView === 'uploadsAll',\n    field: 'id',\n    values: page.selected[page.currentView],\n    cb (failed) {\n      // Update state of checkboxes\n      if (failed.length) {\n        page.selected[page.currentView] = page.selected[page.currentView]\n          .filter(id => failed.includes(id))\n      } else {\n        page.selected[page.currentView] = []\n      }\n\n      // Update local storage\n      if (page.selected[page.currentView].length) {\n        localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n      } else {\n        delete localStorage[lsKeys.selected[page.currentView]]\n      }\n\n      // Reload uploads list\n      // eslint-disable-next-line compat/compat\n      page.getUploads(Object.assign(page.views[page.currentView], {\n        autoPage: true\n      }))\n    }\n  })\n}\n\npage.deleteUploadsByNames = (params = {}) => {\n  let appendix = ''\n  if (page.permissions.moderator) {\n    appendix = '<br><b>Hint:</b> You can use this feature to delete uploads by other users.'\n  }\n\n  page.dom.innerHTML = `\n    <form class=\"prevent-default\">\n      <div class=\"field\">\n        <label class=\"label\">Upload names:</label>\n        <div class=\"control\">\n          <textarea id=\"bulkDeleteNames\" class=\"textarea\"></textarea>\n        </div>\n        <p class=\"help\">Separate each entry with a new line.${appendix}</p>\n      </div>\n      <div class=\"field\">\n        <div class=\"control\">\n          <button type=\"submit\" id=\"submitBulkDelete\" class=\"button is-danger is-outlined is-fullwidth\">\n            <span class=\"icon\">\n              <i class=\"icon-trash\"></i>\n            </span>\n            <span>Bulk delete</span>\n          </button>\n        </div>\n      </div>\n    </form>\n  `\n  page.fadeInDom()\n  page.scrollToDom()\n  page.updateTrigger(params.trigger, 'active')\n\n  document.querySelector('#submitBulkDelete').addEventListener('click', () => {\n    if (page.isSomethingLoading) return page.warnSomethingLoading()\n\n    const textArea = document.querySelector('#bulkDeleteNames')\n\n    // Clean up\n    const seen = {}\n    const names = textArea.value\n      .split(/\\r?\\n/)\n      .map(name => {\n        const trimmed = name.trim()\n        return /^[^\\s]+$/.test(trimmed)\n          ? trimmed\n          : ''\n      })\n      .filter(name => {\n        // Filter out invalid and duplicate names\n        return (!name || Object.prototype.hasOwnProperty.call(seen, name))\n          ? false\n          : (seen[name] = true)\n      })\n\n    // Update textarea with cleaned names\n    textArea.value = names.join('\\n')\n\n    if (!names.length) {\n      return swal('An error occurred!', 'You have not entered any upload names.', 'error')\n    }\n\n    page.postBulkDeleteUploads({\n      all: true,\n      field: 'name',\n      values: names,\n      cb (failed) {\n        textArea.value = failed.join('\\n')\n      }\n    })\n  })\n}\n\npage.postBulkDeleteUploads = (params = {}) => {\n  const count = params.values.length\n\n  const objective = `${params.values.length} upload${count === 1 ? '' : 's'}`\n  const boldObjective = objective.replace(/^(\\d*)(.*)/, '<b>$1</b>$2')\n  let text = `<p>You won't be able to recover ${boldObjective}!</p>`\n\n  if (params.all) {\n    const obj1 = count === 1 ? 'an upload' : 'some uploads'\n    const obj2 = count === 1 ? 'another user' : 'other users'\n    text += `\\n<p><b>Warning:</b> You may be nuking ${obj1} by ${obj2}!</p>`\n  }\n\n  const content = document.createElement('div')\n  content.innerHTML = text\n\n  swal({\n    title: 'Are you sure?',\n    content,\n    icon: 'warning',\n    dangerMode: true,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: `Yes, nuke ${params.values.length === 1 ? 'it' : 'them'}!`,\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/upload/bulkdelete', {\n      field: params.field,\n      values: params.values\n    }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false) {\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n      }\n\n      const failed = Array.isArray(response.data.failed) ? response.data.failed : []\n      if (failed.length === params.values.length) {\n        swal('An error occurred!', `Unable to delete any of the ${objective}.`, 'error')\n      } else if (failed.length && failed.length < params.values.length) {\n        swal('Warning!', `From ${objective}, unable to delete ${failed.length} of them.`, 'warning')\n      } else {\n        swal('Deleted!', `${objective} ${count === 1 ? 'has' : 'have'} been deleted.`, 'success', {\n          buttons: false,\n          timer: 1500\n        })\n      }\n\n      if (typeof params.cb === 'function') params.cb(failed)\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.addSelectedUploadsToAlbum = () => {\n  if (page.currentView !== 'uploads') return\n\n  const count = page.selected[page.currentView].length\n  if (!count) return swal('An error occurred!', 'You have not selected any uploads.', 'error')\n\n  page.addUploadsToAlbum(page.selected[page.currentView], failed => {\n    if (!failed) return\n    if (failed.length) {\n      page.selected[page.currentView] = page.selected[page.currentView]\n        .filter(id => failed.includes(id))\n    } else {\n      page.selected[page.currentView] = []\n    }\n\n    localStorage[lsKeys.selected[page.currentView]] = JSON.stringify(page.selected[page.currentView])\n    page.getUploads(page.views[page.currentView])\n  })\n}\n\npage.addToAlbum = id => {\n  page.addUploadsToAlbum([id], failed => {\n    if (!failed) return\n    page.getUploads(page.views[page.currentView])\n  })\n}\n\npage.addUploadsToAlbum = (ids, callback) => {\n  const count = ids.length\n\n  const content = document.createElement('div')\n  content.innerHTML = `\n    <div class=\"field has-text-centered\">\n      <p>You are about to add <b>${count}</b> upload${count === 1 ? '' : 's'} to an album.</p>\n      <p><b>If an upload is already in an album, it will be moved.</b></p>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <div class=\"select is-fullwidth\">\n          <select id=\"swalAlbum\" disabled>\n            <option value=\"-1\">Remove from album</option>\n            <option value=\"\" selected disabled>Fetching albums list\\u2026</option>\n          </select>\n        </div>\n      </div>\n    </div>\n  `\n\n  swal({\n    icon: 'warning',\n    content,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: 'OK',\n        closeModal: false\n      }\n    }\n  }).then(choose => {\n    if (!choose) return\n\n    const albumid = parseInt(document.querySelector('#swalAlbum').value)\n    if (isNaN(albumid)) return swal('An error occurred!', 'You did not choose an album.', 'error')\n\n    axios.post('api/albums/addfiles', {\n      ids,\n      albumid\n    }).then(add => {\n      if (!add) return\n\n      if (add.data.success === false) {\n        if (add.data.description === 'No token provided') {\n          page.verifyToken(page.token)\n        } else {\n          swal('An error occurred!', add.data.description, 'error')\n        }\n        return\n      }\n\n      let added = ids.length\n      if (add.data.failed && add.data.failed.length) {\n        added -= add.data.failed.length\n      }\n\n      const suffix = `upload${ids.length === 1 ? '' : 's'}`\n      if (!added) return swal('An error occurred!', `Could not add the ${suffix} to the album.`, 'error')\n\n      swal('Woohoo!', `Successfully ${albumid < 0 ? 'removed' : 'added'} ${added} ${suffix} ${albumid < 0 ? 'from' : 'to'} the album.`, 'success', {\n        buttons: false,\n        timer: 1500\n      })\n      callback(add.data.failed)\n    }).catch(page.onAxiosError)\n  })\n\n  // Get albums list then update content of swal\n  axios.get('api/albums', { headers: { simple: '1' } }).then(list => {\n    if (list.data.success === false) {\n      if (list.data.description === 'No token provided') {\n        page.verifyToken(page.token)\n      } else {\n        swal('An error occurred!', list.data.description, 'error')\n      }\n      return\n    }\n\n    // If the prompt was replaced, the container would be missing\n    const select = document.querySelector('#swalAlbum')\n    if (!select) return\n\n    select.innerHTML += list.data.albums\n      .map(album => {\n        return `<option value=\"${album.id}\">${album.name}</option>`\n      })\n      .join('\\n')\n\n    select.getElementsByTagName('option')[1].innerHTML = 'Choose an album'\n    select.removeAttribute('disabled')\n  }).catch(page.onAxiosError)\n}\n\npage.getAlbums = (params = {}) => {\n  if (params && params.all && !page.permissions.moderator) {\n    return swal('An error occurred!', 'You cannot do this!', 'error')\n  }\n\n  if (page.isSomethingLoading) return page.warnSomethingLoading()\n\n  page.updateTrigger(params.trigger, 'loading')\n\n  if (typeof params.pageNum !== 'number') params.pageNum = 0\n\n  const headers = {}\n  if (params.all) headers.all = '1'\n\n  const url = `api/albums/${params.pageNum}`\n  axios.get(url, { headers }).then(response => {\n    if (!response) return\n\n    if (response.data.success === false) {\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n    }\n\n    const pages = Math.ceil(response.data.count / 25)\n    const albums = response.data.albums\n    if (params.pageNum && (albums.length === 0)) {\n      page.updateTrigger(params.trigger)\n      if (params.autoPage) {\n        params.pageNum = pages - 1\n        return page.getAlbums(params)\n      } else {\n        return swal('An error occurred!', `There are no more albums to populate page ${params.pageNum + 1}.`, 'error')\n      }\n    }\n\n    page.currentView = params.all ? 'albumsAll' : 'albums'\n    page.cache = {}\n\n    const users = response.data.users\n    const homeDomain = response.data.homeDomain\n\n    if (params.pageNum < 0) params.pageNum = Math.max(0, pages + params.pageNum)\n    const pagination = page.paginate(response.data.count, 25, params.pageNum)\n\n    const filter = `\n      <div class=\"column\">\n        <form class=\"prevent-default\">\n          <div class=\"field has-addons\">\n            <div class=\"control is-expanded\">\n              <input id=\"filters\" class=\"input is-small\" type=\"text\" placeholder=\"Filter albums (WIP)\" value=\"${page.escape(params.filters || '')}\" disabled>\n            </div>\n            <div class=\"control\">\n              <button type=\"button\" class=\"button is-small is-primary is-outlined\" title=\"Help? (WIP)\" data-action=\"album-filters-help\" disabled>\n                <span class=\"icon\">\n                  <i class=\"icon-help-circled\"></i>\n                </span>\n              </button>\n            </div>\n            <div class=\"control\">\n              <button type=\"submit\" class=\"button is-small is-info is-outlined\" title=\"Filter albums (WIP)\" data-action=\"filter-albums\" disabled>\n                <span class=\"icon\">\n                  <i class=\"icon-filter\"></i>\n                </span>\n              </button>\n            </div>\n          </div>\n        </form>\n      </div>\n    `\n    const extraControls = `\n      <div class=\"columns\">\n        ${filter}\n        <div class=\"column is-one-quarter\">\n          <form class=\"prevent-default\">\n            <div class=\"field has-addons\">\n              <div class=\"control is-expanded\">\n                <input id=\"jumpToPage\" class=\"input is-small\" type=\"number\" min=\"1\" max=\"${pages}\" value=\"${params.pageNum + 1}\"${pages === 1 ? ' disabled' : ''}>\n              </div>\n              <div class=\"control\">\n                <button type=\"submit\" class=\"button is-small is-info is-outlined\" title=\"Jump to page\" data-action=\"jump-to-page\">\n                  <span class=\"icon\">\n                    <i class=\"icon-paper-plane\"></i>\n                  </span>\n                </button>\n              </div>\n            </div>\n          </form>\n        </div>\n      </div>\n    `\n\n    const controls = `\n      <div class=\"columns\">\n        <div class=\"column is-hidden-mobile\"></div>\n        <div class=\"column bulk-operations has-text-right\">\n          <a class=\"button is-small is-info is-outlined\" title=\"Clear selection\" data-action=\"clear-selection\">\n            <span class=\"icon\">\n              <i class=\"icon-cancel\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-dangerish is-outlined\" title=\"Bulk disable (WIP)\" data-action=\"bulk-disable-albums\" disabled>\n            <span class=\"icon\">\n              <i class=\"icon-trash\"></i>\n            </span>\n            ${!params.all ? '<span>Bulk disable</span>' : ''}\n          </a>\n          ${params.all\n            ? `<a class=\"button is-small is-danger is-outlined\" title=\"Bulk delete (WIP)\" data-action=\"bulk-delete-albums\" disabled>\n                <span class=\"icon\">\n                  <i class=\"icon-trash\"></i>\n                </span>\n                <span>Bulk delete</span>\n              </a>`\n            : ''}\n        </div>\n      </div>\n    `\n\n    // Do some string replacements for bottom controls\n    const bottomFiltersId = 'bFilters'\n    const bottomJumpId = 'bJumpToPage'\n    const bottomExtraControls = extraControls\n      .replace(/id=\"filters\"/, `id=\"${bottomFiltersId}\"`)\n      .replace(/(data-action=\"filter-uploads\")/, `$1 data-filtersid=\"${bottomFiltersId}\"`)\n      .replace(/id=\"jumpToPage\"/, `id=\"${bottomJumpId}\"`)\n      .replace(/(data-action=\"jump-to-page\")/g, `$1 data-jumpid=\"${bottomJumpId}\"`)\n    const bottomPagination = pagination\n      .replace(/(data-action=\"page-ellipsis\")/g, `$1 data-jumpid=\"${bottomJumpId}\"`)\n\n    // Whether there are any unselected items\n    let unselected = false\n\n    const createNewAlbum = `\n      <h2 class=\"subtitle\">Create new album</h2>\n      <form class=\"prevent-default\">\n        <div class=\"field\">\n          <div class=\"control\">\n            <input id=\"albumName\" class=\"input\" type=\"text\" placeholder=\"Name\" maxlength=\"${page.albumTitleMaxLength}\">\n          </div>\n          <p class=\"help\">Max length is ${page.albumTitleMaxLength} characters.</p>\n        </div>\n        <div class=\"field\">\n          <div class=\"control\">\n            <textarea id=\"albumDescription\" class=\"textarea\" placeholder=\"Description\" rows=\"1\" maxlength=\"${page.albumDescMaxLength}\"></textarea>\n          </div>\n          <p class=\"help\">Max length is ${page.albumDescMaxLength} characters.</p>\n        </div>\n        <div class=\"field\">\n          <div class=\"control\">\n            <button type=\"submit\" id=\"submitAlbum\" class=\"button is-info is-outlined is-fullwidth\" data-action=\"submit-album\">\n              <span class=\"icon\">\n                <i class=\"icon-paper-plane\"></i>\n              </span>\n              <span>Create</span>\n            </button>\n          </div>\n        </div>\n      </form>\n      <hr>\n    `\n\n    page.dom.innerHTML = `\n      ${!params.all ? createNewAlbum : ''}\n      ${pagination}\n      ${extraControls}\n      ${controls}\n      <div class=\"table-container has-text-left\">\n        <table class=\"table is-narrow is-fullwidth is-hoverable\">\n          <thead>\n            <tr>\n              <th><input id=\"selectAll\" class=\"checkbox\" type=\"checkbox\" title=\"Select all\" data-action=\"select-all\"></th>\n              <th>ID</th>\n              <th>Name</th>\n              ${params.all ? '<th>User</th>' : ''}\n              <th>Uploads</th>\n              <th>Created at</th>\n              <th>Public link</th>\n              <th class=\"has-text-right\">(${response.data.count} total)</th>\n            </tr>\n          </thead>\n          <tbody id=\"table\">\n          </tbody>\n        </table>\n      </div>\n      ${controls}\n      ${bottomExtraControls}\n      ${bottomPagination}\n    `\n\n    const table = document.querySelector('#table')\n\n    for (let i = 0; i < albums.length; i++) {\n      const album = albums[i]\n      const albumUrl = `${homeDomain}/a/${album.identifier}`\n\n      const selected = page.selected[page.currentView].includes(album.id)\n      if (!selected) unselected = true\n\n      // Prettify\n      album.prettyDate = page.getPrettyDate(new Date(album.timestamp * 1000))\n\n      // Server-side explicitly expect this value to consider an album as disabled\n      const enabled = album.enabled !== 0\n      page.cache[album.id] = {\n        name: album.name,\n        download: album.download,\n        public: album.public,\n        description: album.description,\n        enabled\n      }\n\n      const tr = document.createElement('tr')\n      tr.dataset.id = album.id\n      tr.innerHTML = `\n        <td class=\"controls\"><input type=\"checkbox\" class=\"checkbox\" title=\"Select\" data-index=\"${i}\" data-action=\"select\"${selected ? ' checked' : ''}></td>\n        <th>${album.id}</th>\n        <th${enabled ? '' : ' class=\"has-text-grey\"'}>${album.name}</td>\n        ${params.all ? `<th>${album.userid ? (users[album.userid] || '') : ''}</th>` : ''}\n        <th>${album.uploads}</th>\n        <td>${album.prettyDate}</td>\n        <td><a ${enabled && album.public ? '' : 'class=\"is-linethrough\" '}href=\"${albumUrl}\" target=\"_blank\">${albumUrl}</a></td>\n        <td class=\"has-text-right\" data-id=\"${album.id}\">\n          <a class=\"button is-small is-primary is-outlined\" title=\"Edit album\" data-action=\"edit-album\">\n            <span class=\"icon is-small\">\n              <i class=\"icon-pencil\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-info is-outlined\" title=\"${album.uploads ? 'View uploads' : 'Album doesn\\'t have uploads'}\" data-action=\"view-album-uploads\" ${album.uploads ? '' : 'disabled'}>\n            <span class=\"icon\">\n              <i class=\"icon-docs\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-info is-outlined clipboard-js\" title=\"Copy link to clipboard\" ${album.public ? `data-clipboard-text=\"${albumUrl}\"` : 'disabled'}>\n            <span class=\"icon is-small\">\n              <i class=\"icon-clipboard\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-warning is-outlined\" title=\"Download album\" ${enabled && album.download ? `href=\"api/album/zip/${album.identifier}?v=${album.editedAt}\"` : 'disabled'}>\n            <span class=\"icon is-small\">\n              <i class=\"icon-download\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-dangerish is-outlined\" title=\"Disable album\" data-action=\"disable-album\"${enabled ? '' : ' disabled'}>\n            <span class=\"icon is-small\">\n              <i class=\"icon-trash\"></i>\n            </span>\n          </a>\n        </td>\n      `\n\n      table.appendChild(tr)\n      page.checkboxes = table.querySelectorAll('.checkbox[data-action=\"select\"]')\n    }\n\n    const selectAll = document.querySelector('#selectAll')\n    if (selectAll && !unselected) {\n      selectAll.checked = true\n      selectAll.title = 'Unselect all'\n    }\n\n    page.fadeInDom()\n\n    const pageNum = albums.length ? params.pageNum : 0\n    if (params.forceScroll ||\n      page.prevPageNums[page.currentView] === null ||\n      page.prevPageNums[page.currentView] !== pageNum) {\n      page.scrollToDom()\n    }\n\n    page.updateTrigger(params.trigger, 'active')\n\n    if (page.currentView === 'albumsAll') {\n      page.views[page.currentView].filters = params.filters\n    }\n    page.views[page.currentView].pageNum = page.prevPageNums[page.currentView] = pageNum\n  }).catch(error => {\n    page.updateTrigger(params.trigger)\n    page.onAxiosError(error)\n  })\n}\n\npage.editAlbum = id => {\n  const album = page.cache[id]\n  if (!album) return\n\n  const div = document.createElement('div')\n  div.innerHTML = `\n    <div class=\"field\">\n      <div class=\"controls\">\n        <input id=\"swalName\" class=\"input\" type=\"text\" placeholder=\"Name\" maxlength=\"${page.albumTitleMaxLength}\" value=\"${(album.name || '').substring(0, page.albumTitleMaxLength)}\">\n      </div>\n      <p class=\"help\">Max length is ${page.albumTitleMaxLength} characters.</p>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <textarea id=\"swalDescription\" class=\"textarea\" placeholder=\"Description\" rows=\"2\" maxlength=\"${page.albumDescMaxLength}\">${(album.description || '').substring(0, page.albumDescMaxLength)}</textarea>\n      </div>\n      <p class=\"help\">Max length is ${page.albumDescMaxLength} characters.</p>\n    </div>\n    ${page.currentView === 'albumsAll' && page.permissions.moderator\n      ? `<div class=\"field\">\n          <div class=\"control\">\n            <label class=\"checkbox\">\n              <input id=\"swalEnabled\" type=\"checkbox\" ${album.enabled ? 'checked' : ''}>\n              Enabled\n            </label>\n          </div>\n        </div>`\n      : ''}\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalDownload\" type=\"checkbox\" ${album.download ? 'checked' : ''}>\n          Enable download\n        </label>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalPublic\" type=\"checkbox\" ${album.public ? 'checked' : ''}>\n          Enable public link\n        </label>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalRequestLink\" type=\"checkbox\">\n          Request new public link\n        </label>\n      </div>\n    </div>\n  `\n\n  swal({\n    title: 'Edit album',\n    icon: 'info',\n    content: div,\n    buttons: {\n      cancel: true,\n      confirm: {\n        closeModal: false\n      }\n    }\n  }).then(value => {\n    if (!value) return\n\n    const post = {\n      id,\n      name: document.querySelector('#swalName').value.trim(),\n      description: document.querySelector('#swalDescription').value.trim(),\n      download: document.querySelector('#swalDownload').checked,\n      public: document.querySelector('#swalPublic').checked,\n      requestLink: document.querySelector('#swalRequestLink').checked\n    }\n\n    if (page.currentView === 'albumsAll' && page.permissions.moderator) {\n      post.enabled = document.querySelector('#swalEnabled').checked\n    }\n\n    axios.post('api/albums/edit', post).then(response => {\n      if (!response) return\n\n      if (response.data.success === false) {\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n      }\n\n      if (response.data.identifier) {\n        swal('Success!', `The album's new identifier is: ${response.data.identifier}.`, 'success')\n      } else if (response.data.name !== album.name) {\n        swal('Success!', `The album was renamed to: ${response.data.name}.`, 'success')\n      } else {\n        swal('Success!', 'The album was edited.', 'success', {\n          buttons: false,\n          timer: 1500\n        })\n      }\n\n      page.getAlbumsSidebar()\n      // Reload albums list\n      // eslint-disable-next-line compat/compat\n      page.getAlbums(Object.assign(page.views[page.currentView], {\n        autoPage: true\n      }))\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.disableAlbum = id => {\n  swal({\n    title: 'Are you sure?',\n    text: 'This won\\'t delete the uploads associated with the album!',\n    icon: 'warning',\n    dangerMode: true,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: 'Yes, disable it!',\n        closeModal: false\n      },\n      purge: {\n        text: 'Umm, delete the uploads, please?',\n        value: 'purge',\n        className: 'swal-button--danger',\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/albums/disable', {\n      id,\n      purge: proceed === 'purge'\n    }).then(response => {\n      if (response.data.success === false) {\n        const failed = Array.isArray(response.data.failed)\n          ? response.data.failed\n          : []\n\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else if (failed.length) {\n          return swal('An error occurred!', `Unable to delete ${failed.length} of the album's upload${failed.length === 1 ? '' : 's'}.`, 'error')\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n      }\n\n      swal('Disabled!', 'Your album has been disabled.', 'success', {\n        buttons: false,\n        timer: 1500\n      })\n\n      page.getAlbumsSidebar()\n      // Reload albums list\n      // eslint-disable-next-line compat/compat\n      page.getAlbums(Object.assign(page.views[page.currentView], {\n        autoPage: true\n      }))\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.submitAlbum = element => {\n  page.updateTrigger(element, 'loading')\n\n  axios.post('api/albums', {\n    name: document.querySelector('#albumName').value.trim(),\n    description: document.querySelector('#albumDescription').value.trim()\n  }).then(response => {\n    if (!response) return\n\n    page.updateTrigger(element)\n    if (response.data.success === false) {\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n    }\n\n    swal('Woohoo!', 'Album was created successfully.', 'success', {\n      buttons: false,\n      timer: 1500\n    })\n    page.getAlbumsSidebar()\n    page.getAlbums({\n      pageNum: -1\n    })\n  }).catch(error => {\n    page.updateTrigger(element)\n    page.onAxiosError(error)\n  })\n}\n\npage.getAlbumsSidebar = () => {\n  axios.get('api/albums', { headers: { simple: '1' } }).then(response => {\n    if (!response) return\n\n    if (response.data.success === false) {\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n    }\n\n    const albums = response.data.albums\n    const count = response.data.count\n    const albumsSidebar = document.querySelector('#albumsSidebar')\n\n    // Clear albums sidebar if necessary\n    const oldAlbums = albumsSidebar.querySelectorAll('li > a')\n    const diffCount = oldAlbums.length !== count\n    if (oldAlbums.length) {\n      for (let i = 0; i < oldAlbums.length; i++) {\n        page.menus.splice(page.menus.indexOf(oldAlbums[i]), 1)\n      }\n      albumsSidebar.innerHTML = ''\n    }\n\n    page.albumsSidebarCollapse.innerText = page.albumsSidebarCollapsible.collapsed()\n      ? page.albumsSidebarCollapse.dataset.textExpand\n      : page.albumsSidebarCollapse.dataset.textCollapse\n\n    if (!albums || !albums.length) {\n      page.albumsSidebarCollapsible.collapse()\n      page.albumsSidebarCollapse.setAttribute('disabled', 'disabled')\n      return\n    }\n\n    for (let i = 0; i < albums.length; i++) {\n      const album = albums[i]\n      const li = document.createElement('li')\n      const a = document.createElement('a')\n      a.id = album.id\n      a.className = 'is-relative'\n      a.innerHTML = album.name\n\n      a.addEventListener('click', event => {\n        page.getUploads({\n          album: parseInt(event.currentTarget.id),\n          trigger: event.currentTarget\n        })\n      })\n      page.menus.push(a)\n\n      li.appendChild(a)\n      albumsSidebar.appendChild(li)\n    }\n\n    page.albumsSidebarCollapse.removeAttribute('disabled')\n    if (!page.albumsSidebarCollapsible.collapsed() && diffCount) {\n      // Since it's not possible to refresh collapsible's height with bulmaCollapsible APIs,\n      // forcefully collapse albums sidebar if albums count is different with the previous iteration.\n      page.albumsSidebarCollapsible.collapse()\n    }\n  }).catch(page.onAxiosError)\n}\n\npage.changeToken = (params = {}) => {\n  page.dom.innerHTML = `\n    <div class=\"field\">\n      <label class=\"label\">Your current token:</label>\n      <div class=\"field\">\n        <div class=\"control\">\n          <input id=\"token\" readonly class=\"input\" type=\"text\" placeholder=\"Your token\" value=\"${page.token}\">\n        </div>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <a id=\"getNewToken\" class=\"button is-info is-outlined is-fullwidth\">\n          <span class=\"icon\">\n            <i class=\"icon-arrows-cw\"></i>\n          </span>\n          <span>Request new token</span>\n        </a>\n      </div>\n    </div>\n  `\n  page.fadeInDom()\n  page.scrollToDom()\n  page.updateTrigger(params.trigger, 'active')\n\n  document.querySelector('#getNewToken').addEventListener('click', event => {\n    if (page.isSomethingLoading) return page.warnSomethingLoading()\n\n    const trigger = event.currentTarget\n    page.updateTrigger(trigger, 'loading')\n    axios.post('api/tokens/change').then(response => {\n      if (response.data.success === false) {\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          page.updateTrigger(trigger)\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n      }\n\n      page.updateTrigger(trigger)\n      swal({\n        title: 'Woohoo!',\n        text: 'Your token was successfully changed.',\n        icon: 'success',\n        buttons: false,\n        timer: 1500\n      }).then(() => {\n        axios.defaults.headers.common.token = response.data.token\n        localStorage[lsKeys.token] = response.data.token\n        page.token = response.data.token\n        page.changeToken()\n      })\n    }).catch(error => {\n      page.updateTrigger(trigger)\n      page.onAxiosError(error)\n    })\n  })\n}\n\npage.changePassword = (params = {}) => {\n  page.dom.innerHTML = `\n    <form class=\"prevent-default\">\n      <div class=\"field\">\n        <label class=\"label\">New password:</label>\n        <div class=\"control\">\n          <input id=\"password\" class=\"input\" type=\"password\" minlength=\"6\" maxlength=\"64\">\n        </div>\n      </div>\n      <div class=\"field\">\n        <label class=\"label\">Re-type new password:</label>\n        <div class=\"control\">\n          <input id=\"passwordConfirm\" class=\"input\" type=\"password\" minlength=\"6\" maxlength=\"64\">\n        </div>\n      </div>\n      <div class=\"field\">\n        <div class=\"control\">\n          <button type=\"submit\" id=\"sendChangePassword\" class=\"button is-info is-outlined is-fullwidth\">\n            <span class=\"icon\">\n              <i class=\"icon-paper-plane\"></i>\n            </span>\n            <span>Set new password</span>\n          </button>\n        </div>\n      </div>\n    </form>\n  `\n  page.fadeInDom()\n  page.scrollToDom()\n  page.updateTrigger(params.trigger, 'active')\n\n  document.querySelector('#sendChangePassword').addEventListener('click', event => {\n    if (page.isSomethingLoading) return page.warnSomethingLoading()\n\n    if (!page.dom.querySelector('form').checkValidity()) return\n\n    if (document.querySelector('#password').value === document.querySelector('#passwordConfirm').value) {\n      page.sendNewPassword(document.querySelector('#password').value, event.currentTarget)\n    } else {\n      swal({\n        title: 'Password mismatch!',\n        text: 'Your passwords do not match, please try again.',\n        icon: 'error'\n      })\n    }\n  })\n}\n\npage.sendNewPassword = (pass, element) => {\n  page.updateTrigger(element, 'loading')\n\n  axios.post('api/password/change', { password: pass }).then(response => {\n    if (response.data.success === false) {\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(element)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n    }\n\n    page.updateTrigger(element)\n    swal({\n      title: 'Woohoo!',\n      text: 'Your password was successfully changed.',\n      icon: 'success',\n      buttons: false,\n      timer: 1500\n    }).then(() => {\n      page.changePassword()\n    })\n  }).catch(error => {\n    page.updateTrigger(element)\n    page.onAxiosError(error)\n  })\n}\n\npage.getUsers = (params = {}) => {\n  if (!page.permissions.admin) return swal('An error occurred!', 'You cannot do this!', 'error')\n\n  if (page.isSomethingLoading) return page.warnSomethingLoading()\n\n  page.updateTrigger(params.trigger, 'loading')\n\n  if (typeof params.pageNum !== 'number') params.pageNum = 0\n\n  const url = `api/users/${params.pageNum}`\n  axios.get(url).then(response => {\n    if (response.data.success === false) {\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n    }\n\n    const pages = Math.ceil(response.data.count / 25)\n    const users = response.data.users\n    if (params.pageNum && (users.length === 0)) {\n      page.updateTrigger(params.trigger)\n      if (params.autoPage) {\n        params.pageNum = pages - 1\n        return page.getUsers(params)\n      } else {\n        return swal('An error occurred!', `There are no more users to populate page ${params.pageNum + 1}.`, 'error')\n      }\n    }\n\n    page.currentView = 'users'\n    page.cache = {}\n\n    if (params.pageNum < 0) params.pageNum = Math.max(0, pages + params.pageNum)\n    const pagination = page.paginate(response.data.count, 25, params.pageNum)\n\n    const filter = `\n      <div class=\"column\">\n        <form class=\"prevent-default\">\n          <div class=\"field has-addons\">\n            <div class=\"control is-expanded\">\n              <input id=\"filters\" class=\"input is-small\" type=\"text\" placeholder=\"Filter users (WIP)\" value=\"${page.escape(params.filters || '')}\" disabled>\n            </div>\n            <div class=\"control\">\n              <button type=\"button\" class=\"button is-small is-primary is-outlined\" title=\"Help? (WIP)\" data-action=\"user-filters-help\" disabled>\n                <span class=\"icon\">\n                  <i class=\"icon-help-circled\"></i>\n                </span>\n              </button>\n            </div>\n            <div class=\"control\">\n              <button type=\"submit\" class=\"button is-small is-info is-outlined\" title=\"Filter users (WIP)\" data-action=\"filter-users\" disabled>\n                <span class=\"icon\">\n                  <i class=\"icon-filter\"></i>\n                </span>\n              </button>\n            </div>\n          </div>\n        </form>\n      </div>\n    `\n    const extraControls = `\n      <div class=\"columns\">\n        ${filter}\n        <div class=\"column is-one-quarter\">\n          <form class=\"prevent-default\">\n            <div class=\"field has-addons\">\n              <div class=\"control is-expanded\">\n                <input id=\"jumpToPage\" class=\"input is-small\" type=\"number\" min=\"1\" max=\"${pages}\" value=\"${params.pageNum + 1}\"${pages === 1 ? ' disabled' : ''}>\n              </div>\n              <div class=\"control\">\n                <button type=\"submit\" class=\"button is-small is-info is-outlined\" title=\"Jump to page\" data-action=\"jump-to-page\">\n                  <span class=\"icon\">\n                    <i class=\"icon-paper-plane\"></i>\n                  </span>\n                </button>\n              </div>\n            </div>\n          </form>\n        </div>\n      </div>\n    `\n\n    const controls = `\n      <div class=\"columns\">\n        <div class=\"column exclusive-operations has-text-left\">\n          <a class=\"button is-small is-primary is-outlined\" title=\"Create new user\" data-action=\"create-user\">\n            <span class=\"icon\">\n              <i class=\"icon-plus\"></i>\n            </span>\n            <span>Create new user</span>\n          </a>\n        </div>\n        <div class=\"column bulk-operations has-text-right\">\n          <a class=\"button is-small is-info is-outlined\" title=\"Clear selection\" data-action=\"clear-selection\">\n            <span class=\"icon\">\n              <i class=\"icon-cancel\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-dangerish is-outlined\" title=\"Bulk disable (WIP)\" data-action=\"bulk-disable-users\" disabled>\n            <span class=\"icon\">\n              <i class=\"icon-hammer\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-danger is-outlined\" title=\"Bulk delete (WIP)\" data-action=\"bulk-delete-users\" disabled>\n            <span class=\"icon\">\n              <i class=\"icon-trash\"></i>\n            </span>\n            <span>Bulk delete</span>\n          </a>\n        </div>\n      </div>\n    `\n\n    // Do some string replacements for bottom controls\n    const bottomFiltersId = 'bFilters'\n    const bottomJumpId = 'bJumpToPage'\n    const bottomExtraControls = extraControls\n      .replace(/id=\"filters\"/, `id=\"${bottomFiltersId}\"`)\n      .replace(/(data-action=\"filter-uploads\")/, `$1 data-filtersid=\"${bottomFiltersId}\"`)\n      .replace(/id=\"jumpToPage\"/, `id=\"${bottomJumpId}\"`)\n      .replace(/(data-action=\"jump-to-page\")/g, `$1 data-jumpid=\"${bottomJumpId}\"`)\n    const bottomPagination = pagination\n      .replace(/(data-action=\"page-ellipsis\")/g, `$1 data-jumpid=\"${bottomJumpId}\"`)\n\n    // Whether there are any unselected items\n    let unselected = false\n\n    page.dom.innerHTML = `\n      ${pagination}\n      ${extraControls}\n      ${controls}\n      <div class=\"table-container has-text-left\">\n        <table class=\"table is-narrow is-fullwidth is-hoverable\">\n          <thead>\n            <tr>\n              <th><input id=\"selectAll\" class=\"checkbox\" type=\"checkbox\" title=\"Select all\" data-action=\"select-all\"></th>\n              <th title=\"Key: username\">Username</th>\n              <th>Uploads</th>\n              <th>Usage</th>\n              <th title=\"Key: permission\">Group</th>\n              <th title=\"Key: registration\">Registration date</th>\n              <th title=\"Key: timestamp\">Last token update</th>\n              <th class=\"has-text-right\">(${response.data.count} total)</th>\n            </tr>\n          </thead>\n          <tbody id=\"table\">\n          </tbody>\n        </table>\n      </div>\n      ${controls}\n      ${bottomExtraControls}\n      ${bottomPagination}\n    `\n\n    const table = document.querySelector('#table')\n\n    for (let i = 0; i < users.length; i++) {\n      const user = users[i]\n      const selected = page.selected[page.currentView].includes(user.id)\n      if (!selected) unselected = true\n\n      let displayGroup = null\n      const groups = Object.keys(user.groups)\n      for (let i = 0; i < groups.length; i++) {\n        if (!user.groups[groups[i]]) break\n        displayGroup = groups[i]\n      }\n\n      // Server-side explicitly expects either of these two values to consider a user as disabled\n      const enabled = user.enabled !== false && user.enabled !== 0\n      page.cache[user.id] = {\n        username: user.username,\n        groups: user.groups,\n        enabled,\n        displayGroup\n      }\n\n      const prettyDate = user.registration\n        ? page.getPrettyDate(new Date(user.registration * 1000))\n        : '-'\n      const prettyTokenUpdate = user.timestamp\n        ? page.getPrettyDate(new Date(user.timestamp * 1000))\n        : '-'\n\n      const tr = document.createElement('tr')\n      tr.dataset.id = user.id\n      tr.innerHTML = `\n        <td class=\"controls\"><input type=\"checkbox\" class=\"checkbox\" title=\"Select\" data-index=\"${i}\" data-action=\"select\"${selected ? ' checked' : ''}></td>\n        <th${enabled ? '' : ' class=\"has-text-grey\"'}>${user.username}</td>\n        <th>${user.uploads}</th>\n        <td>${page.getPrettyBytes(user.usage)}</td>\n        <td>${displayGroup}</td>\n        <td>${prettyDate}</td>\n        <td>${prettyTokenUpdate}</td>\n        <td class=\"controls has-text-right\">\n          <a class=\"button is-small is-primary is-outlined\" title=\"Edit user\" data-action=\"edit-user\">\n            <span class=\"icon\">\n              <i class=\"icon-pencil\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-info is-outlined\" title=\"${user.uploads ? 'View uploads' : 'User doesn\\'t have uploads'}\" data-action=\"view-user-uploads\" ${user.uploads ? '' : 'disabled'}>\n            <span class=\"icon\">\n              <i class=\"icon-docs\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-dangerish is-outlined\" title=\"${enabled ? 'Disable user' : 'User is disabled'}\" data-action=\"disable-user\" ${enabled ? '' : 'disabled'}>\n            <span class=\"icon\">\n              <i class=\"icon-hammer\"></i>\n            </span>\n          </a>\n          <a class=\"button is-small is-danger is-outlined\" title=\"Delete user\" data-action=\"delete-user\">\n            <span class=\"icon\">\n              <i class=\"icon-trash\"></i>\n            </span>\n          </a>\n        </td>\n      `\n\n      table.appendChild(tr)\n      page.checkboxes = table.querySelectorAll('.checkbox[data-action=\"select\"]')\n    }\n\n    const selectAll = document.querySelector('#selectAll')\n    if (selectAll && !unselected) {\n      selectAll.checked = true\n      selectAll.title = 'Unselect all'\n    }\n\n    page.fadeInDom()\n\n    const pageNum = users.length ? params.pageNum : 0\n    if (params.forceScroll ||\n      page.prevPageNums[page.currentView] === null ||\n      page.prevPageNums[page.currentView] !== pageNum) {\n      page.scrollToDom()\n    }\n\n    page.updateTrigger(params.trigger, 'active')\n\n    page.views[page.currentView].pageNum = page.prevPageNums[page.currentView] = pageNum\n  }).catch(error => {\n    page.updateTrigger(params.trigger)\n    page.onAxiosError(error)\n  })\n}\n\npage.createUser = () => {\n  const groupOptions = Object.keys(page.permissions).map((g, i, a) => {\n    const disabled = !(a[i + 1] && page.permissions[a[i + 1]])\n    return `<option value=\"${g}\"${disabled ? ' disabled' : ''}>${g}</option>`\n  }).join('\\n')\n\n  const div = document.createElement('div')\n  div.innerHTML = `\n    <div class=\"field\">\n      <label class=\"label\">Username</label>\n      <div class=\"controls\">\n        <input id=\"swalUsername\" class=\"input\" type=\"text\">\n      </div>\n    </div>\n    <div class=\"field\">\n      <label class=\"label\">Password (optional)</label>\n      <div class=\"controls\">\n        <input id=\"swalPassword\" class=\"input\" type=\"text\">\n      </div>\n    </div>\n    <div class=\"field\">\n      <label class=\"label\">User group</label>\n      <div class=\"control\">\n        <div class=\"select is-fullwidth\">\n          <select id=\"swalGroup\">\n            ${groupOptions}\n          </select>\n        </div>\n      </div>\n    </div>\n  `\n\n  swal({\n    title: 'Create new user',\n    icon: 'info',\n    content: div,\n    buttons: {\n      cancel: true,\n      confirm: {\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/users/create', {\n      username: document.querySelector('#swalUsername').value,\n      password: document.querySelector('#swalPassword').value,\n      group: document.querySelector('#swalGroup').value\n    }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false) {\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n      }\n\n      const div = document.createElement('div')\n      div.innerHTML = `\n        <p>Username: <b>${response.data.username}</b></p>\n        <p>Password: <code>${response.data.password}</code></p>\n        <p>User group: <b>${response.data.group}</b></p>\n      `\n      swal({\n        title: 'Created a new user!',\n        icon: 'success',\n        content: div\n      })\n\n      // Load last page of users list\n      // eslint-disable-next-line compat/compat\n      page.getUsers(Object.assign(page.views.users, {\n        pageNum: -1\n      }))\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.editUser = id => {\n  const user = page.cache[id]\n  if (!user) return\n\n  let isHigher = false\n  const groupOptions = Object.keys(page.permissions).map((g, i, a) => {\n    const selected = g === user.displayGroup\n    if (selected) {\n      isHigher = typeof a[i + 1] !== 'undefined' && page.permissions[a[i + 1]]\n    }\n    const disabled = !(a[i + 1] && page.permissions[a[i + 1]])\n    return `<option value=\"${g}\"${selected ? ' selected' : ''}${disabled ? ' disabled' : ''}>${g}</option>`\n  }).join('\\n')\n\n  const isDisabledHelper = isHigher ? '' : ' disabled'\n  const div = document.createElement('div')\n  div.innerHTML = `\n    <div class=\"field\">\n      <p>User ID: ${id}</p>\n    </div>\n    <div class=\"field\">\n      <label class=\"label\">Username</label>\n      <div class=\"controls\">\n        <input id=\"swalUsername\" class=\"input\" type=\"text\" value=\"${user.username || ''}\"${isDisabledHelper}>\n      </div>\n    </div>\n    <div class=\"field\">\n      <label class=\"label\">User group</label>\n      <div class=\"control\">\n        <div class=\"select is-fullwidth\">\n          <select id=\"swalGroup\"${isDisabledHelper}>\n            ${groupOptions}\n          </select>\n        </div>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalEnabled\" type=\"checkbox\"${user.enabled ? ' checked' : ''}${isDisabledHelper}>\n          Enabled\n        </label>\n      </div>\n    </div>\n    <div class=\"field\">\n      <div class=\"control\">\n        <label class=\"checkbox\">\n          <input id=\"swalResetPassword\" type=\"checkbox\"${isDisabledHelper}>\n          Reset password\n        </label>\n      </div>\n    </div>\n    ${isHigher\n      ? ''\n      : `<div class=\"notification is-danger\">\n      You <strong>cannot</strong> modify user in the same or higher group as you.\n    </div>`\n    }\n  `\n\n  swal({\n    title: 'Edit user',\n    icon: 'info',\n    content: div,\n    buttons: {\n      cancel: true,\n      confirm: {\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/users/edit', {\n      id,\n      username: document.querySelector('#swalUsername').value,\n      group: document.querySelector('#swalGroup').value,\n      enabled: document.querySelector('#swalEnabled').checked,\n      resetPassword: document.querySelector('#swalResetPassword').checked\n    }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false) {\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n      }\n\n      let autoClose = true\n      const div = document.createElement('div')\n\n      let displayName = user.username\n      if (response.data.update.username !== user.username) {\n        div.innerHTML += `<p>${user.username} was renamed into: <b>${response.data.update.username}</b>.</p>`\n        autoClose = false\n        displayName = response.data.update.username\n      }\n\n      if (response.data.update.password) {\n        div.innerHTML += `\n          <p>${displayName}'s new password is:</p>\n          <p><code>${response.data.update.password}</code></p>\n        `\n        autoClose = false\n      }\n\n      if (response.data.update.enabled !== user.enabled) {\n        div.innerHTML += `<p>${displayName} has been ${response.data.update.enabled ? 'enabled' : 'disabled'}!</p>`\n      }\n\n      if (!div.innerHTML) {\n        div.innerHTML = `<p>${displayName} was edited!</p>`\n      }\n\n      swal({\n        title: 'Success!',\n        icon: 'success',\n        content: div,\n        buttons: !autoClose,\n        timer: autoClose ? 1500 : null\n      })\n      page.getUsers(page.views.users)\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.disableUser = id => {\n  const user = page.cache[id]\n  if (!user || !user.enabled) return\n\n  const content = document.createElement('div')\n  content.innerHTML = `\n    <p>You will be disabling a user named <b>${page.cache[id].username}</b>.</p>\n    <p>Their files will remain.</p>\n  `\n\n  swal({\n    title: 'Are you sure?',\n    icon: 'warning',\n    content,\n    dangerMode: true,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: 'Yes, disable them!',\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/users/disable', { id }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false) {\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n      }\n\n      swal('Success!', `${page.cache[id].username} has been disabled.`, 'success', {\n        buttons: false,\n        timer: 1500\n      })\n      page.getUsers(page.views.users)\n    }).catch(page.onAxiosError)\n  })\n}\n\npage.deleteUser = id => {\n  const user = page.cache[id]\n  if (!user) return\n\n  const content = document.createElement('div')\n  content.innerHTML = `\n    <p>You will be deleting a user named <b>${page.cache[id].username}</b>.<p>\n    <p>Their files will remain, unless you choose otherwise.</p>\n  `\n\n  swal({\n    title: 'Are you sure?',\n    icon: 'warning',\n    content,\n    dangerMode: true,\n    buttons: {\n      cancel: true,\n      confirm: {\n        text: 'Yes, delete it!',\n        closeModal: false\n      },\n      purge: {\n        text: 'Yes, and the uploads too!',\n        value: 'purge',\n        className: 'swal-button--danger',\n        closeModal: false\n      }\n    }\n  }).then(proceed => {\n    if (!proceed) return\n\n    axios.post('api/users/delete', {\n      id,\n      purge: proceed === 'purge'\n    }).then(response => {\n      if (!response) return\n\n      if (response.data.success === false) {\n        const failed = Array.isArray(response.data.failed)\n          ? response.data.failed\n          : []\n\n        if (response.data.description === 'No token provided') {\n          return page.verifyToken(page.token)\n        } else if (failed.length) {\n          return swal('An error occurred!', `Unable to delete ${failed.length} of the user's upload${failed.length === 1 ? '' : 's'}.`, 'error')\n        } else {\n          return swal('An error occurred!', response.data.description, 'error')\n        }\n      }\n\n      swal('Success!', `${page.cache[id].username} has been deleted.`, 'success', {\n        buttons: false,\n        timer: 1500\n      })\n\n      // Reload users list\n      // eslint-disable-next-line compat/compat\n      page.getUsers(Object.assign(page.views.users, {\n        autoPage: true\n      }))\n    }).catch(page.onAxiosError)\n  })\n}\n\n// Roughly based on https://github.com/mayuska/pagination/blob/master/index.js\npage.paginate = (totalItems, itemsPerPage, currentPage) => {\n  currentPage = currentPage + 1\n  const step = 3\n  const numPages = Math.ceil(totalItems / itemsPerPage)\n\n  let template = ''\n  const elementsToShow = step * 2\n  const add = {\n    pageNum (start, end) {\n      for (let i = start; i <= end; ++i) {\n        template += `<li><a class=\"button pagination-link ${i === currentPage ? ' is-current' : ''}\" aria-label=\"Goto page ${i}\" data-action=\"page-goto\" data-goto=\"${i - 1}\">${i}</a></li>`\n      }\n    },\n    startDots () {\n      template += `\n        <li><a class=\"button pagination-link\" aria-label=\"Goto page 1\" data-action=\"page-goto\" data-goto=\"0\">1</a></li>\n        <li data-action=\"page-ellipsis\"><span class=\"pagination-ellipsis\">&hellip;</span></li>\n      `\n    },\n    endDots () {\n      template += `\n        <li data-action=\"page-ellipsis\"><span class=\"pagination-ellipsis\">&hellip;</span></li>\n        <li><a class=\"button pagination-link\" aria-label=\"Goto page ${numPages}\" data-action=\"page-goto\" data-goto=\"${numPages - 1}\">${numPages}</a></li>\n      `\n    }\n  }\n\n  if (elementsToShow + 1 >= numPages) {\n    add.pageNum(1, numPages)\n  } else if (currentPage < elementsToShow) {\n    add.pageNum(1, elementsToShow)\n    add.endDots()\n  } else if (currentPage > numPages - elementsToShow + 1) {\n    add.startDots()\n    add.pageNum(numPages - elementsToShow + 1, numPages)\n  } else {\n    add.startDots()\n    add.pageNum(currentPage - step + 1, currentPage + step - 1)\n    add.endDots()\n  }\n\n  return `\n    <nav class=\"pagination is-centered is-small\">\n      <a class=\"button pagination-previous\" data-action=\"page-prev\"${currentPage === 1 ? ' disabled' : ''}>Previous</a>\n      <a class=\"button pagination-next\" data-action=\"page-next\"${currentPage >= numPages ? ' disabled' : ''}>Next page</a>\n      <ul class=\"pagination-list\">${template}</ul>\n    </nav>\n  `\n}\n\npage.getStatistics = (params = {}) => {\n  if (!page.permissions.admin) return swal('An error occurred!', 'You cannot do this!', 'error')\n\n  if (page.isSomethingLoading) return page.warnSomethingLoading()\n\n  page.updateTrigger(params.trigger, 'loading')\n\n  const url = 'api/stats'\n  axios.get(url).then(response => {\n    if (response.data.success === false) {\n      if (response.data.description === 'No token provided') {\n        return page.verifyToken(page.token)\n      } else {\n        page.updateTrigger(params.trigger)\n        return swal('An error occurred!', response.data.description, 'error')\n      }\n    }\n\n    let content = ''\n    const keys = Object.keys(response.data.stats)\n    for (let i = 0; i < keys.length; i++) {\n      let rows = ''\n      if (!response.data.stats[keys[i]]) {\n        rows += `\n          <tr>\n            <td>Generating, please try again later\\u2026</td>\n            <td></td>\n          </tr>\n        `\n      } else {\n        try {\n          const valKeys = Object.keys(response.data.stats[keys[i]])\n          for (let j = 0; j < valKeys.length; j++) {\n            const data = response.data.stats[keys[i]][valKeys[j]]\n            const type = typeof data === 'object' ? data.type : 'auto'\n            const value = typeof data === 'object' ? data.value : data\n\n            let parsed\n            switch (type) {\n              case 'byte':\n                parsed = page.getPrettyBytes(value)\n                break\n              case 'byteUsage': {\n                // Reasoning: https://github.com/sebhildebrandt/systeminformation/issues/464#issuecomment-756406053\n                const totalForPercentage = typeof value.available !== 'undefined'\n                  ? (value.used + value.available)\n                  : value.total\n                parsed = `${page.getPrettyBytes(value.used)} / ${page.getPrettyBytes(value.total)} (${(value.used / totalForPercentage * 100).toFixed(2)}%)`\n                break\n              }\n              case 'uptime':\n                parsed = page.getPrettyUptime(value)\n                break\n              case 'auto':\n                switch (typeof value) {\n                  case 'number':\n                    parsed = value.toLocaleString()\n                    break\n                  default:\n                    parsed = value\n                }\n                break\n              default:\n                parsed = value\n            }\n\n            rows += `\n              <tr>\n                <th>${valKeys[j]}</th>\n                <td>${parsed}</td>\n              </tr>\n            `\n          }\n        } catch (error) {\n          rows = `\n              <tr>\n                <td>Error parsing response. Try again?</td>\n                <td></td>\n              </tr>\n            `\n          page.onError(error)\n        }\n      }\n\n      content += `\n        <div class=\"table-container has-text-left\">\n          <table id=\"statistics\" class=\"table is-narrow is-fullwidth is-hoverable\">\n            <thead>\n              <tr>\n                <th class=\"capitalize\">${keys[i]}</th>\n                <td></td>\n              </tr>\n            </thead>\n            <tbody>\n              ${rows}\n            </tbody>\n          </table>\n        </div>\n      `\n    }\n\n    if (Array.isArray(response.data.hrtime)) {\n      content += `\n        <article class=\"message is-size-7\">\n          <div class=\"message-body has-text-left\">\n            Time taken: ${response.data.hrtime[0]}s ${Math.ceil(response.data.hrtime[1] / 1000000)}ms.\n          </div>\n        </article>\n      `\n    }\n\n    page.dom.innerHTML = content\n    page.fadeInDom()\n    page.scrollToDom()\n    page.updateTrigger(params.trigger, 'active')\n  }).catch(error => {\n    page.updateTrigger(params.trigger)\n    page.onAxiosError(error)\n  })\n}\n\nwindow.addEventListener('DOMContentLoaded', () => {\n  // Polyfill Object.assign()\n  // eslint-disable-next-line compat/compat\n  if (typeof Object.assign !== 'function') {\n    // Must be writable: true, enumerable: false, configurable: true\n    Object.defineProperty(Object, 'assign', {\n      value: function assign (target, varArgs) { // .length of function is 2\n        'use strict'\n        if (target === null || typeof target === 'undefined') {\n          throw new TypeError('Cannot convert undefined or null to object')\n        }\n        const to = Object(target)\n        for (let i = 1; i < arguments.length; i++) {\n          const nextSource = arguments[i]\n          if (nextSource !== null && typeof nextSource !== 'undefined') {\n            for (const nextKey in nextSource) {\n              // Avoid bugs when hasOwnProperty is shadowed\n              if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n                to[nextKey] = nextSource[nextKey]\n              }\n            }\n          }\n        }\n        return to\n      },\n      writable: true,\n      configurable: true\n    })\n  }\n\n  // Add 'no-touch' class to non-touch devices\n  if (!('ontouchstart' in document.documentElement)) {\n    document.documentElement.classList.add('no-touch')\n  }\n\n  const selectedKeys = ['uploads', 'uploadsAll', 'albums', 'albumsAll', 'users']\n  for (let i = 0; i < selectedKeys.length; i++) {\n    const ls = localStorage[lsKeys.selected[selectedKeys[i]]]\n    if (ls) page.selected[selectedKeys[i]] = JSON.parse(ls)\n  }\n\n  page.preparePage()\n\n  page.clipboardJS = new ClipboardJS('.clipboard-js')\n\n  page.clipboardJS.on('success', () => {\n    return swal('', 'The link has been copied to clipboard.', 'success', {\n      buttons: false,\n      timer: 1500\n    })\n  })\n\n  page.clipboardJS.on('error', page.onError)\n\n  page.lazyLoad = new LazyLoad()\n\n  page.albumsSidebarCollapse = document.querySelector('#albumsSidebarCollapse')\n\n  /* eslint-disable-next-line new-cap */\n  page.albumsSidebarCollapsible = new bulmaCollapsible(document.querySelector('#albumsSidebar'))\n  page.albumsSidebarCollapsible.on('before:expand', event => {\n    page.albumsSidebarCollapse.innerText = page.albumsSidebarCollapse.dataset.textCollapse\n  })\n  page.albumsSidebarCollapsible.on('before:collapse', event => {\n    page.albumsSidebarCollapse.innerText = page.albumsSidebarCollapse.dataset.textExpand\n  })\n})\n"]}